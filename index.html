<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tangail Buzz - বাংলাদেশের সেরা ই-কমার্স প্ল্যাটফর্ম</title>
    <!-- jsPDF Libraries for Invoice Generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+Bengali:wght@400;500;600;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap');

        /* বেসিক সিএসএস রিসেট এবং স্টাইল */
        :root {
            --primary-color: #E94B62;
            --secondary-color: #4AC7B9;
            --text-dark: #333;
            --text-light: #777;
            --bg-light: #FFFFFF;
            --bg-offwhite: #F9FAFB;
            --border-color: #E5E7EB;
            --accent-yellow: #FFC94A;
        }

        body.dark-mode {
            --text-dark: #E5E7EB; 
            --text-light: #9CA3AF; 
            --bg-light: #1F2937;  
            --bg-offwhite: #111827; 
            --border-color: #374151; 
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Noto Sans Bengali', 'Poppins', sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--bg-offwhite);
            color: var(--text-dark);
            transition: background-color 0.3s, color 0.3s;
        }
        
        body.lang-en {
             font-family: 'Poppins', 'Noto Sans Bengali', sans-serif;
        }

        .container {
            width: 90%;
            max-width: 1200px;
            margin: auto;
        }

        /* হেডার এবং নেভিগেশন */
        .main-header {
            background: var(--bg-light);
            padding: 15px 0;
            border-bottom: 1px solid var(--border-color);
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            transition: background-color 0.3s;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            text-decoration: none;
            color: var(--text-dark);
            cursor: pointer;
        }

        .logo-image {
            width: 40px;
            height: 40px;
            margin-right: 10px;
        }

        .logo-text {
            font-size: 1.5em;
            font-weight: 600;
        }

        .navbar {
            display: flex;
            gap: 25px;
        }

        .navbar a {
            text-decoration: none;
            color: var(--text-light);
            font-weight: 500;
            font-size: 1.1em;
            transition: color 0.3s;
            cursor: pointer;
        }

        .navbar a:hover {
            color: var(--primary-color);
        }
        
        .search-bar {
            position: relative;
            width: 250px;
        }

        .search-bar input {
            width: 100%;
            padding: 8px 35px 8px 15px;
            border-radius: 20px;
            border: 1px solid var(--border-color);
            font-size: 1em;
            background-color: var(--bg-light);
            color: var(--text-dark);
            transition: background-color 0.3s, border-color 0.3s;
        }

        .search-bar input::placeholder {
            color: var(--text-light);
        }
        
        .search-bar .search-icon {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-light);
        }

        .header-controls {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .header-controls .icon-btn {
            position: relative;
            cursor: pointer;
        }
        
        .hamburger {
            display: none;
            cursor: pointer;
        }
        
        .hamburger div {
            width: 25px;
            height: 3px;
            background-color: var(--text-dark);
            margin: 5px 0;
            transition: all 0.3s;
        }


        .language-dropdown {
            position: relative;
            display: inline-block;
        }

        .selected-lang {
            display: flex;
            align-items: center;
            gap: 8px;
            background-color: var(--bg-offwhite);
            border: 1px solid var(--border-color);
            padding: 8px 12px;
            border-radius: 20px;
            cursor: pointer;
            color: var(--text-dark);
            font-weight: 500;
            width: 120px;
        }

        .selected-lang svg {
            width: 20px;
            height: 15px;
            border-radius: 3px;
        }

        .dropdown-options {
            display: none;
            position: absolute;
            top: 110%;
            left: 0;
            background-color: var(--bg-light);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            z-index: 1001;
            overflow: hidden;
            width: 100%;
        }

        .language-dropdown.open .dropdown-options {
            display: block;
        }
        
        .lang-btn {
            background: transparent;
            border: none;
            padding: 8px 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--text-dark);
            font-weight: 500;
            width: 100%;
            text-align: left;
        }
        
        .lang-btn svg {
             width: 20px;
             height: 15px;
             border-radius: 3px;
        }

        .lang-option:hover {
            background-color: var(--bg-offwhite);
        }

        .header-controls .cart-count {
            position: absolute;
            top: -8px;
            right: -8px;
            background-color: var(--primary-color);
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 0.8em;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        /* Cart Modal Styles */
        #cart-modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }
        #cart-modal-overlay.visible { display: flex; }
        .cart-modal-content {
            background-color: var(--bg-light);
            padding: 20px;
            border-radius: 15px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            display: flex;
            flex-direction: column;
        }
        .cart-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 15px;
            margin-bottom: 0;
        }
        .cart-items-list {
            flex-grow: 1;
            overflow-y: auto;
            margin-bottom: 15px;
        }
        .cart-item {
            display: flex;
            gap: 15px;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid var(--border-color);
        }
        .cart-item:last-child { border-bottom: none; }
        .cart-item img {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 8px;
        }
        .cart-item-details { flex-grow: 1; }
        .cart-item-quantity {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .quantity-btn {
            background-color: var(--bg-offwhite);
            border: 1px solid var(--border-color);
            width: 25px;
            height: 25px;
            border-radius: 50%;
            cursor: pointer;
        }
        .cart-item-remove { cursor: pointer; color: var(--primary-color); }
        .cart-summary {
            padding-top: 15px;
            border-top: 1px solid var(--border-color);
        }
        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }
        .cart-total {
            font-weight: 700;
            font-size: 1.2em;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid var(--border-color);
        }
        .checkout-btn {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 8px;
            background-color: var(--secondary-color);
            color: white;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            margin-top: 20px;
        }
        #empty-cart-message { text-align: center; padding: 40px 0; }

        /* Payment Modal */
        .payment-option {
            padding: 15px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            margin-bottom: 10px;
            cursor: pointer;
        }
        .payment-option.active {
            border-color: var(--primary-color);
            background-color: var(--bg-offwhite);
        }
        .sub-options {
            display: none;
            padding-left: 20px;
            margin-top: 10px;
        }
        .payment-option.active .sub-options { display: block; }
        
        /* Order Success Modal */
        #order-success-modal-overlay .auth-modal-content {
            text-align: center;
        }
        #order-success-modal-overlay .success-icon {
            font-size: 3em;
            color: var(--secondary-color);
            margin-bottom: 20px;
        }

        /* Auth Modal Styles */
        #auth-modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }

        #auth-modal-overlay.visible {
            display: flex;
        }

        .auth-modal-content {
            background-color: var(--bg-light);
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 400px;
            position: relative;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            max-height: 90vh;
            overflow-y: auto;
        }

        .auth-modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 1.5em;
            cursor: pointer;
            line-height: 1;
            color: var(--text-light);
        }
        
        .auth-view {
            display: none;
        }
        .auth-view.active {
            display: block;
        }

        .auth-tabs {
            display: flex;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 20px;
            width: 100%;
        }
        .auth-tab {
            flex: 1;
            padding: 10px;
            text-align: center;
            cursor: pointer;
            font-weight: 600;
            color: var(--text-light);
            border-bottom: 2px solid transparent;
        }
        .auth-tab.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
        }

        .auth-form h3 {
            text-align: center;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        .form-group input {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            box-sizing: border-box;
            background-color: var(--bg-offwhite);
            color: var(--text-dark);
        }

        .auth-btn {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 8px;
            background-color: var(--primary-color);
            color: white;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            margin-top: 10px;
        }
        .google-btn {
            background-color: #4285F4;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .auth-link {
            text-align: center;
            margin-top: 15px;
        }
        .auth-link a {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 600;
            cursor: pointer;
        }
        .auth-message {
            text-align: center;
            margin-top: 15px;
            font-weight: 500;
        }
        .auth-message.error { color: var(--primary-color); }
        .auth-message.success { color: var(--secondary-color); }


        #account-view ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        #account-view li {
            padding: 15px 10px;
            border-bottom: 1px solid var(--border-color);
            cursor: pointer;
        }
        #account-view li:hover {
            background-color: var(--bg-offwhite);
        }
        #account-view li:last-child {
            border-bottom: none;
        }
        #logout-btn, #delete-account-btn {
            color: var(--primary-color);
            font-weight: 600;
        }
        #address-list {
            margin-top: 20px;
        }
        .address-item {
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            margin-bottom: 10px;
        }
        #password-requirements {
            font-size: 0.9em;
            margin-top: -10px;
            margin-bottom: 15px;
            color: var(--text-light);
        }
        #password-requirements ul {
            list-style: none;
            padding: 0;
            margin: 5px 0 0 0;
        }
        #password-requirements li {
            padding-left: 20px;
            position: relative;
            transition: color 0.3s;
        }
        #password-requirements li::before {
            content: '✖';
            color: var(--primary-color);
            position: absolute;
            left: 0;
        }
        #password-requirements li.valid {
            color: var(--secondary-color);
        }
        #password-requirements li.valid::before {
            content: '✔';
            color: var(--secondary-color);
            position: absolute;
            left: 0;
        }
        
        /* Order History Styles */
        #order-history-view h3 { text-align: center; margin-bottom: 20px; }
        .orders-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .order-card {
            background-color: var(--bg-light);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 15px;
        }
        .order-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
        }
        .order-header strong { font-size: 0.9em; color: var(--text-light); }
        .order-status {
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.9em;
            font-weight: 600;
        }
        .status-pending { background-color: #FEF3C7; color: #92400E; } /* Amber */
        .status-confirmed { background-color: #D1FAE5; color: #065F46; } /* Green */
        .status-shipped { background-color: #DBEAFE; color: #1E40AF; } /* Blue */
        .status-delivered { background-color: #E5E7EB; color: #374151; } /* Gray */
        .status-cancelled { background-color: #FEE2E2; color: #991B1B; } /* Red */
        .order-item {
            font-size: 0.9em;
            color: var(--text-light);
            margin-bottom: 4px;
        }
        .order-footer {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .order-total {
            font-weight: 700;
            color: var(--text-dark);
        }
        .invoice-btn {
            background-color: var(--secondary-color);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9em;
        }


        /* হিরো বা শোকেস সেকশন */
        #showcase {
            height: 60vh; /* Adjust height as needed */
            max-height: 450px;
            position: relative;
            overflow: hidden;
            display: block; /* ব্যানার অপশনটি আবার দেখানো হয়েছে */
        }

        .slider {
            display: flex;
            height: 100%;
            transition: transform 0.5s ease-in-out;
        }

        .slide {
            min-width: 100%;
            height: 100%;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
            color: white;
        }

        .slide img {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: 1;
        }
        
        .slide::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.4);
            z-index: 2;
        }
        
        .slide-content {
            position: relative;
            z-index: 3;
            padding: 20px;
        }
        
        .slide-content h1 {
            font-size: 3.2em;
            font-weight: 700;
            margin: 0;
        }
        
        .slide-content p {
            font-size: 1.3em;
            margin: 15px 0 30px 0;
        }

        .cta-button {
            background: var(--accent-yellow);
            color: #333; /* Dark text on yellow button */
            padding: 14px 35px;
            text-decoration: none;
            border-radius: 25px;
            font-size: 1.1em;
            font-weight: 600;
            transition: transform 0.3s;
            cursor: pointer;
        }
        
        .cta-button:hover {
            transform: scale(1.05);
        }
        
        .slider-nav {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
            z-index: 4;
        }
        
        .slider-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.5);
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .slider-dot.active {
            background-color: white;
        }

        .slider-arrow {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            z-index: 5;
            background-color: rgba(0, 0, 0, 0.3);
            color: white;
            border: none;
            width: 44px;
            height: 44px;
            font-size: 24px;
            cursor: pointer;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: background-color 0.3s;
        }
        .slider-arrow:hover {
            background-color: rgba(0, 0, 0, 0.6);
        }
        .prev-btn { left: 20px; }
        .next-btn { right: 20px; }


        /* ক্যাটাগরি সেকশন */
        #categories {
            padding: 60px 0;
            text-align: center;
        }

        #categories h2 {
            font-size: 2.2em;
            margin-bottom: 30px;
            color: var(--text-dark);
        }
        
        .category-filters {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .filter-btn {
            background: var(--bg-light);
            border: 1px solid var(--border-color);
            padding: 10px 25px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 500;
            transition: background-color 0.3s, color 0.3s;
            color: var(--text-dark);
        }

        .filter-btn:hover, .filter-btn.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        /* পণ্য সেকশন */
        #products {
            padding: 20px 0 60px 0;
        }
        
        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            min-height: 300px; /* To show loader */
            position: relative;
        }

        .product-card {
            background: var(--bg-light);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            transition: transform 0.3s, box-shadow 0.3s;
            position: relative;
            display: flex;
            transition: background-color 0.3s, border-color 0.3s; /* Smooth theme transition */
            flex-direction: column;
        }
        
        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px rgba(0,0,0,0.1);
        }

        .product-card img {
            width: 100%;
            height: 200px;
            object-fit: contain;
            padding: 10px;
            box-sizing: border-box;
            cursor: pointer;
        }
        
        .product-info {
            padding: 0 20px 20px 20px;
            text-align: left;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }

        .product-card h3 {
            font-size: 1.1em;
            margin: 0 0 10px 0;
            font-weight: 500;
            min-height: 44px; /* For 2 lines of text */
        }

        .product-card .rating {
             color: var(--accent-yellow);
             font-size: 1.1em;
             margin-bottom: 5px;
        }
        
        .product-price {
            margin-bottom: 15px;
        }

        .current-price {
            color: var(--primary-color);
            font-weight: 600;
            font-size: 1.2em;
        }
        
        .old-price {
            color: var(--text-light);
            text-decoration: line-through;
            margin-left: 10px;
            font-size: 1em;
        }
        .offer-tag-right {
            position: absolute;
            top: 15px;
            right: 15px;
            background-color: var(--accent-yellow);
            color: #333; /* Dark text on yellow tag */
            padding: 4px 10px;
            border-radius: 5px;
            font-size: 0.9em;
            font-weight: 600;
        }

        .product-actions {
            display: flex;
            gap: 10px;
            margin-top: auto; /* Pushes buttons to the bottom */
        }
        
        .btn {
            text-decoration: none;
            padding: 8px 12px;
            border-radius: 8px;
            font-weight: 500;
            text-align: center;
            flex-grow: 1;
            font-size: 0.9em;
            cursor: pointer;
        }
        
        .btn-details {
            background-color: var(--secondary-color);
            color: white;
        }

        .btn-add-cart {
            background-color: var(--primary-color);
            color: white;
        }

        .offer-tag {
            position: absolute;
            top: 15px;
            left: 15px;
            background-color: var(--accent-yellow);
            color: #333; /* Dark text on yellow tag */
            padding: 4px 10px;
            border-radius: 5px;
            font-size: 0.9em;
            font-weight: 600;
        }

        /* About Us Section */
        #about-us {
            padding: 80px 0;
            background: var(--bg-light);
            transition: background-color 0.3s; /* Smooth theme transition */
            display: none; /* প্রাথমিকভাবে লুকানো থাকবে */
        }

        .about-content {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 50px;
            align-items: center;
        }

        .about-image img {
            width: 100%;
            border-radius: 15px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        .about-text h2 {
            font-size: 2.5em;
            margin-bottom: 20px;
        }
        
        .about-text .about-list {
            list-style: none;
            padding-left: 0;
        }
        .about-text .about-list li {
            position: relative;
            padding-left: 25px;
            margin-bottom: 10px;
        }
        .about-text .about-list li::before {
            content: '✔';
            color: var(--secondary-color);
            position: absolute;
            left: 0;
        }

        .about-text p {
            font-size: 1.1em;
            line-height: 1.8;
            color: var(--text-light);
            margin-bottom: 15px;
        }

        .founder-info {
            margin-top: 30px;
            background: var(--bg-offwhite);
            padding: 20px;
            border-radius: 10px;
            border-left: 5px solid var(--primary-color);
        }

        .founder-info h3 {
            margin: 0 0 5px 0;
            font-size: 1.5em;
        }

        .founder-info p {
            margin: 0;
            font-size: 1.1em;
            color: var(--primary-color);
            font-weight: 600;
        }


        /* ফুটার */
        .main-footer {
            background: #2D3748; /* Dark Grayish Blue */
            color: #A0AEC0; /* Light Gray */
            padding: 60px 0 20px 0;
        }

        .footer-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 40px;
            margin-bottom: 40px;
        }

        .footer-col h4 {
            color: #FFFFFF; /* Footer titles are always white */
            font-size: 1.3em;
            margin-bottom: 20px;
        }

        .footer-col p, .footer-col a {
            color: #A0AEC0;
            text-decoration: none;
            line-height: 1.8;
        }

        .footer-col a:hover {
            color: var(--secondary-color);
        }

        .footer-col ul {
            list-style: none;
            padding: 0;
        }

        .footer-col ul li {
            margin-bottom: 10px;
        }

        .contact-info li {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px !important;
        }

        .payment-methods {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .payment-methods span {
            background: #FFFFFF;
            color: #333;
            padding: 5px 10px;
            border-radius: 4px;
            font-weight: 600;
        }

        .social-links {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        .social-links a {
            background: rgba(255,255,255, 0.1);
            width: 40px;
            height: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 50%;
            color: white;
            transition: background-color 0.3s;
        }

        .social-links a:hover {
            background: var(--secondary-color);
        }

        .footer-bottom {
            border-top: 1px solid #4A5568;
            text-align: center;
            padding-top: 20px;
        }

        /* পণ্য বিবরণী মোডাল স্টাইল */
        .modal-overlay {
            display: none; /* ডিফল্টভাবে লুকানো থাকবে */
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }

        .modal-overlay.visible {
            display: flex;
        }

        .modal-content {
            background: var(--bg-light);
            padding: 30px;
            border-radius: 15px;
            width: 80%;
            max-width: 900px;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        .modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 2em;
            cursor: pointer;
            line-height: 1;
            color: var(--text-light);
        }
        
        .modal-images .main-image img {
            width: 100%;
            border-radius: 10px;
            border: 1px solid var(--border-color);
        }

        .thumbnail-images {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .thumbnail-images img {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 8px;
            cursor: pointer;
            border: 2px solid var(--border-color);
            transition: border-color 0.3s;
        }

        .thumbnail-images img:hover, .thumbnail-images img.active {
            border-color: var(--primary-color);
        }
        
        .modal-details h2 {
            font-size: 2em;
            margin-top: 0;
            margin-bottom: 10px;
        }

        .product-rating {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            font-size: 1.2em;
            color: var(--text-light);
        }
        
        .modal-price {
            font-size: 1.8em;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 15px;
        }

        .modal-description {
            line-height: 1.7;
            color: var(--text-light);
            margin-bottom: 20px;
        }

        .spec-list {
            list-style: none;
            padding: 0;
            margin: 20px 0 0 0;
        }

        .spec-list li {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 12px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .spec-list li:last-child {
            border-bottom: none;
        }

        .spec-icon {
            color: var(--secondary-color);
            flex-shrink: 0;
        }

        .spec-text .spec-key {
            font-size: 0.9em;
            color: var(--text-light);
            display: block;
        }
        .spec-text .spec-value {
            font-weight: 600;
            color: var(--text-dark);
            display: block;
        }

        .modal-meta-info {
            font-size: 0.9em;
            color: var(--text-light);
            margin-bottom: 15px;
            padding: 10px;
            background: var(--bg-offwhite);
            border-radius: 8px;
        }
        .modal-meta-info p {
            margin: 4px 0;
        }
        .modal-meta-info strong {
            color: var(--text-dark);
        }
        .modal-tags {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        .tag-available {
            background-color: #4CAF50; /* Green */
            color: white;
        }
        .tag-unofficial {
            background-color: #FF9800; /* Orange */
            color: white;
        }
        /* Product Reviews section in Modal */
        #product-reviews {
            margin-top: 30px;
        }

        #product-reviews h3 {
            margin-bottom: 20px;
        }

        #reviews-list {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 15px;
        }

        .review-card {
            background-color: var(--bg-offwhite);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            border: 1px solid var(--border-color);
        }

        .review-card:last-child {
            margin-bottom: 0;
        }

        .review-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .review-header strong {
            font-weight: 600;
        }

        .review-header span {
            color: var(--accent-yellow);
        }

        #review-form-container {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
        }

        #star-rating {
            display: flex;
            gap: 5px;
            font-size: 2em;
            cursor: pointer;
            color: var(--text-light);
        }
        #star-rating .star.filled {
            color: var(--accent-yellow);
        }

        #review-text-area {
            width: 100%;
            height: 100px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 10px;
            box-sizing: border-box;
            background-color: var(--bg-offwhite);
            color: var(--text-dark);
            margin-top: 10px;
        }

        #review-submit-btn {
            width: 100%;
            padding: 10px;
            border: none;
            border-radius: 8px;
            background-color: var(--primary-color);
            color: white;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            margin-top: 10px;
        }

        /* Responsive Styles */
        @media (max-width: 768px) {
            .header-content {
                flex-wrap: wrap;
                justify-content: space-between;
            }
            .navbar {
                display: none;
                flex-direction: column;
                width: 100%;
                background: var(--bg-light);
                position: absolute;
                top: 100%;
                left: 0;
                padding: 10px 0;
                box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            }
             .navbar.active {
                display: flex;
            }
            .navbar a {
                padding: 10px 20px;
                width: 100%;
                box-sizing: border-box;
            }
            .hamburger {
                display: block;
            }
             .hamburger.active .bar:nth-child(2) {
                opacity: 0;
            }
            .hamburger.active .bar:nth-child(1) {
                transform: translateY(8px) rotate(45deg);
            }
            .hamburger.active .bar:nth-child(3) {
                transform: translateY(-8px) rotate(-45deg);
            }

            .search-bar {
                order: 3;
                width: 100%;
                margin-top: 15px;
            }
            .header-controls {
                 gap: 10px;
            }

            #showcase h1, .slide-content h1 {
                font-size: 2.5em;
            }

            .about-content, .modal-content {
                grid-template-columns: 1fr;
            }
            
            .auth-modal-content, .cart-modal-content {
                width: 95%;
                padding: 20px;
            }
        }

    </style>
</head>
<body>

    <!-- হেডার সেকশন -->
    <header class="main-header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <img src="https://github.com/tangailbuzzbd-svg/TangailBuzz-Picture-/blob/main/MD%20EOUSUF%20ALI%20BACK-1_upscaled.png?raw=true" alt="TangailBuzz Logo" class="logo-image">
                    <span class="logo-text">TangailBuzz</span>
                </div>
                <div class="header-controls">
                     <div class="language-dropdown">
                          <button class="selected-lang">
                              <!-- JS will populate this -->
                          </button>
                          <div class="dropdown-options">
                              <button class="lang-btn lang-option" data-lang="bn">
                                  <svg viewBox="0 0 21 15"><path fill="#006a4e" d="M0 0h21v15H0z"></path><path fill="#f42a41" d="M9.5 11a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7z"></path></svg>
                                  <span>বাংলা</span>
                              </button>
                              <button class="lang-btn lang-option" data-lang="en">
                                 <svg viewBox="0 0 60 30" xmlns="http://www.w3.org/2000/svg"><clipPath id="a"><path d="M0 0v30h60V0z"></path></clipPath><clipPath id="b"><path d="M30 15h30v15zv-15h-30zH0V0h30v15z"></path></clipPath><g clip-path="url(#a)"><path d="M0 0v30h60V0z" fill="#012169"></path><path d="M0 0l60 30m0-30L0 30" stroke="#fff" stroke-width="6"></path><path d="M0 0l60 30m0-30L0 30" clip-path="url(#b)" stroke="#C8102E" stroke-width="4"></path><path d="M30 0v30M0 15h60" stroke="#fff" stroke-width="10"></path><path d="M30 0v30M0 15h60" stroke="#C8102E" stroke-width="6"></path></g></svg>
                                  <span>English</span>
                              </button>
                          </div>
                     </div>
                    <div class="icon-btn" id="theme-toggle-btn">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
                    </div>
                    <div class="icon-btn" id="profile-btn">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
                    </div>
                    <div class="icon-btn" id="cart-btn">
                         <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="9" cy="21" r="1"></circle><circle cx="20" cy="21" r="1"></circle><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path></svg>
                        <span class="cart-count">0</span>
                    </div>
                    <div class="hamburger">
                        <div class="bar"></div>
                        <div class="bar"></div>
                        <div class="bar"></div>
                    </div>
                </div>
                <nav class="navbar">
                    <a href="" id="nav-home" data-lang-key="nav-home">হোম</a>
                    <a id="nav-products" data-lang-key="nav-products">পণ্য</a>
                    <a id="nav-offer" data-lang-key="nav-offer">অফার</a>
                    <a id="nav-about" data-lang-key="nav-about">আমাদের সম্পর্কে</a>
                </nav>
                <div class="search-bar">
                    <input type="text" id="searchInput" placeholder="পণ্য খুঁজুন..." data-lang-key="search-placeholder">
                    <span class="search-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                    </span>
                </div>
            </div>
        </div>
    </header>

    <div id="main-content-wrapper">
        <!-- হিরো বা শোকেস সেকশন -->
        <section id="showcase">
            <div class="slider">
                <!-- Slides will be dynamically loaded here -->
            </div>
            <div class="slider-nav">
                <!-- Dots will be generated by JS -->
            </div>
            <button class="slider-arrow prev-btn" id="prev-btn">&#10094;</button>
            <button class="slider-arrow next-btn" id="next-btn">&#10095;</button>
        </section>

        <!-- ক্যাটাগরি সেকশন -->
        <section id="categories">
            <div class="container">
                <h2 data-lang-key="categories-h2">আমাদের ক্যাটাগরি সমূহ</h2>
                <div class="category-filters">
                    <button class="filter-btn active" data-filter="all" data-lang-key="cat-all">সব পণ্য</button>
                    <button class="filter-btn" data-filter="electronics" data-lang-key="cat-electronics">ইলেকট্রনিক্স</button>
                    <button class="filter-btn" data-filter="fashion" data-lang-key="cat-fashion">পোশাক</button>
                    <button class="filter-btn" data-filter="cosmetics" data-lang-key="cat-cosmetics">কসমেটিক</button>
                    <button class="filter-btn" data-filter="household" data-lang-key="cat-household">গৃহস্থালী</button>
                    <button class="filter-btn" data-filter="toys" data-lang-key="cat-toys">খেলনা</button>
                    <button class="filter-btn" data-filter="books" data-lang-key="cat-books">বই</button>
                </div>
            </div>
        </section>

        <!-- পণ্য সেকশন -->
        <main id="products">
            <div class="container">
                <div class="product-grid">
                    <!-- Products will be loaded here from Firebase -->
                </div>
            </div>
        </main>
    </div>
    
    <!-- আমাদের সম্পর্কে সেকশন -->
    <section id="about-us">
        <div class="container">
            <div class="about-content">
                <div class="about-image">
                    <img src="https://github.com/tangailbuzzbd-svg/TangailBuzz-Picture-/blob/448bae242ec48b9d615a15b917e7819e169ea20e/WhatsApp%20Image%202025-07-30%20at%2019.29.33_9f8c7d06.jpg?raw=true" alt="MD EOUSUF ALI - Managing Director">
                </div>
                <div class="about-text">
                    <h2 data-lang-key="about-h2"></h2>
                    <p data-lang-key="about-p1"></p>
                    <p data-lang-key="about-p2"></p>
                    <h4 data-lang-key="about-list-title"></h4>
                    <ul class="about-list">
                        <li data-lang-key="about-list-item1"></li>
                        <li data-lang-key="about-list-item2"></li>
                        <li data-lang-key="about-list-item3"></li>
                        <li data-lang-key="about-list-item4"></li>
                    </ul>
                    <p data-lang-key="about-p3"></p>
                    <div class="founder-info">
                        <h3>MD EOUSUF ALI</h3>
                        <p data-lang-key="founder-title">Founder of TangailBuzz</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- পণ্য বিবরণী মোডাল -->
    <div class="modal-overlay" id="product-details-modal">
        <div class="modal-content">
            <span class="modal-close" id="modal-close-btn">&times;</span>
            <div class="modal-images">
                <div class="main-image">
                    <img src="" id="modal-main-image" alt="Main product image">
                </div>
                <div class="thumbnail-images" id="modal-thumbnails">
                    <!-- Thumbnail images will be generated by JS -->
                </div>
            </div>
            <div class="modal-details">
                <h2 id="modal-product-name"></h2>
                <div class="product-rating">
                    <span id="modal-rating-text"></span>
                </div>
                <div class="modal-price" id="modal-product-price"></div>
                 <div class="modal-meta-info">
                     <p><strong data-lang-key="product-id">Product ID:</strong> <span id="modal-product-id"></span></p>
                     <p><strong data-lang-key="brand">Brand:</strong> <span id="modal-brand"></span></p>
                     <p><strong data-lang-key="category">Category:</strong> <span id="modal-category"></span></p>
                 </div>
                <p class="modal-description" id="modal-product-description"></p>
                <h3 data-lang-key="modal-specs-title">বিস্তারিত তথ্য</h3>
                <ul class="spec-list" id="modal-spec-list">
                    <!-- Specification list will be generated by JS -->
                </ul>

                <!-- Review Section -->
                <div id="product-reviews">
                    <h3 data-lang-key="reviews-heading">Reviews</h3>
                    <div id="reviews-list">
                        <!-- Reviews will be loaded here -->
                    </div>
                    <div id="review-form-container">
                        <h4 data-lang-key="write-review-title">আপনার রিভিউ লিখুন</h4>
                        <div id="star-rating">
                            <!-- Star icons will be generated by JS -->
                        </div>
                        <textarea id="review-text-area" placeholder="আপনার মতামত..."></textarea>
                        <button id="review-submit-btn" data-lang-key="review-submit-btn">জমা দিন</button>
                    </div>
                </div>
                 <div class="product-actions" style="margin-top: 20px;">
                     <a class="btn btn-add-cart" id="modal-add-to-cart-btn" style="flex-grow: 2;" data-lang-key="btn-add-cart">কার্টে যোগ করুন</a>
                 </div>
            </div>
        </div>
    </div>
    
    <!-- Auth Modal -->
    <div id="auth-modal-overlay">
        <div class="auth-modal-content">
            <span class="auth-modal-close" id="auth-modal-close">&times;</span>
            
            <!-- Login/Register View -->
            <div id="login-register-view" class="auth-view">
                <div class="auth-tabs">
                    <div class="auth-tab active" data-tab="login" data-lang-key="auth-login-tab">লগইন</div>
                    <div class="auth-tab" data-tab="register" data-lang-key="auth-register-tab">রেজিস্টার</div>
                </div>
                
                <!-- Login Form -->
                <div id="login-form-container" class="auth-form">
                     <form id="login-form">
                         <h3 data-lang-key="login-title">আপনার একাউন্টে লগইন করুন</h3>
                         <div class="form-group">
                             <label for="login-email" data-lang-key="email-label">ইমেইল</label>
                             <input type="email" id="login-email" required>
                         </div>
                         <div class="form-group">
                             <label for="login-password" data-lang-key="password-label">পাসওয়ার্ড</label>
                             <input type="password" id="login-password" required>
                         </div>
                         <button type="submit" class="auth-btn" data-lang-key="login-btn">লগইন</button>
                     </form>
                    <div class="auth-link">
                        <a id="show-forgot-password" data-lang-key="forgot-password-link">পাসওয়ার্ড ভুলে গেছেন?</a>
                    </div>
                </div>
                
                <!-- Register Form -->
                <div id="register-form-container" class="auth-form" style="display: none;">
                    <form id="register-form">
                        <h3 data-lang-key="register-title">নতুন একাউন্ট তৈরি করুন</h3>
                        <div class="form-group">
                            <label for="register-name" data-lang-key="name-label">নাম</label>
                            <input type="text" id="register-name" required>
                        </div>
                        <div class="form-group">
                            <label for="register-mobile" data-lang-key="mobile-label">মোবাইল</label>
                            <input type="tel" id="register-mobile" required>
                        </div>
                        <div class="form-group">
                            <label for="register-address" data-lang-key="address-label">ঠিকানা</label>
                            <input type="text" id="register-address" required>
                        </div>
                        <div class="form-group">
                            <label for="register-email" data-lang-key="email-label">ইমেইল</label>
                            <input type="email" id="register-email" required>
                        </div>
                        <div class="form-group">
                            <label for="register-password" data-lang-key="password-label">পাসওয়ার্ড</label>
                            <input type="password" id="register-password" required>
                        </div>
                         <div class="form-group">
                             <label for="register-retype-password" data-lang-key="retype-password-label">পুনরায় পাসওয়ার্ড দিন</label>
                             <input type="password" id="register-retype-password" required>
                         </div>
                        <button type="submit" class="auth-btn" data-lang-key="register-btn">রেজিস্টার</button>
                    </form>
                </div>
                <button id="google-signin-btn" class="auth-btn google-btn">
                    <svg width="18" height="18" viewBox="0 0 18 18" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="M17.64 9.2045c0-.6381-.0573-1.2518-.1636-1.8409H9v3.4818h4.8436c-.2086 1.125-.8441 2.0782-1.7777 2.7218v2.2582h2.9082c1.7018-1.5668 2.6836-3.8741 2.6836-6.621z" fill="#4285F4"></path><path d="M9 18c2.43 0 4.4673-.806 5.9564-2.1805l-2.9082-2.2582c-.806.54-1.8377.86-3.0482.86-2.344 0-4.3282-1.5818-5.0355-3.7104H.9573v2.3318C2.4382 15.9832 5.4818 18 9 18z" fill="#34A853"></path><path d="M3.9645 10.71c-.1827-.54-.2827-1.1168-.2827-1.71s.1-1.17.2827-1.71V4.9582H.9573A8.9965 8.9965 0 000 9c0 1.4523.3464 2.8273.9573 4.0418L3.9645 10.71z" fill="#FBBC05"></path><path d="M9 3.5795c1.3214 0 2.5077.4541 3.4405 1.346l2.5813-2.5814C13.4632.8918 11.4259 0 9 0 5.4818 0 2.4382 2.0168.9573 4.9582L3.9645 7.29C4.6718 5.1618 6.656 3.5795 9 3.5795z" fill="#EA4335"></path></g></svg>
                    <span data-lang-key="google-login-btn">গুগল দিয়ে লগইন করুন</span>
                </button>
                 <div id="auth-message-container" class="auth-message"></div>
            </div>

            <!-- Forgot Password View -->
            <div id="forgot-password-view" class="auth-view">
                 <form id="forgot-password-form">
                     <h3 data-lang-key="forgot-password-title">পাসওয়ার্ড রিসেট</h3>
                     <div class="form-group">
                         <label for="forgot-email" data-lang-key="email-label">আপনার ইমেইল দিন</label>
                         <input type="email" id="forgot-email" required>
                     </div>
                     <button type="submit" class="auth-btn" data-lang-key="reset-password-btn">রিসেট লিঙ্ক পাঠান</button>
                     <div class="auth-link">
                         <a id="back-to-login" data-lang-key="back-to-login-link">&laquo; লগইনে ফিরে যান</a>
                     </div>
                 </form>
            </div>

            <!-- Account View (Logged In) -->
            <div id="account-view" class="auth-view">
                <h3 id="user-greeting"></h3>
                <ul>
                    <li id="order-history-btn" data-lang-key="order-history">অর্ডার ইতিহাস</li>
                    <li id="manage-address-btn" data-lang-key="manage-address">ঠিকানা পরিচালনা করুন</li>
                    <li id="change-mobile-btn" data-lang-key="change-mobile">মোবাইল নম্বর পরিবর্তন করুন</li>
                    <li id="logout-btn" data-lang-key="logout">লগআউট</li>
                    <li id="delete-account-btn" data-lang-key="delete-account">একাউন্ট মুছে ফেলুন</li>
                </ul>
            </div>
            
            <!-- Address View -->
            <div id="address-view" class="auth-view">
                 <h3 data-lang-key="address-title">আমার ডিফল্ট ঠিকানা</h3>
                 <div id="address-list"></div>
                 <form id="address-form">
                         <div class="form-group">
                             <label for="address-line1" data-lang-key="address-line1-label">ঠিকানা</label>
                             <input type="text" id="address-line1" required>
                         </div>
                         <div class="form-group">
                             <label for="address-city" data-lang-key="address-city-label">শহর</label>
                             <input type="text" id="address-city" required>
                         </div>
                         <div class="form-group">
                             <label for="address-postal" data-lang-key="address-postal-label">পোস্টাল কোড</label>
                             <input type="text" id="address-postal" required>
                         </div>
                         <button type="submit" class="auth-btn" data-lang-key="save-address-btn">ঠিকানা সংরক্ষণ করুন</button>
                 </form>
                 <div class="auth-link">
                     <a id="back-to-account" data-lang-key="back-to-account-link">&laquo; একাউন্টে ফিরে যান</a>
                 </div>
            </div>
            
             <!-- Mobile Change View -->
            <div id="mobile-view" class="auth-view">
                 <h3 data-lang-key="mobile-title">মোবাইল নম্বর পরিবর্তন</h3>
                 <form id="mobile-form">
                         <div class="form-group">
                             <label for="mobile-number" data-lang-key="mobile-label">নতুন মোবাইল নম্বর</label>
                             <input type="tel" id="mobile-number" required>
                         </div>
                         <button type="submit" class="auth-btn" data-lang-key="save-mobile-btn">সংরক্ষণ করুন</button>
                 </form>
                 <div class="auth-link">
                     <a id="back-to-account-from-mobile" data-lang-key="back-to-account-link">&laquo; একাউন্টে ফিরে যান</a>
                 </div>
            </div>

            <!-- Order History View -->
            <div id="order-history-view" class="auth-view">
                <h3 data-lang-key="order-history-title">আমার অর্ডারসমূহ</h3>
                <div id="orders-list" class="orders-list">
                    <!-- Orders will be dynamically injected here -->
                </div>
                <div class="auth-link">
                    <a id="back-to-account-from-history" data-lang-key="back-to-account-link">&laquo; একাউন্টে ফিরে যান</a>
                </div>
            </div>


        </div>
    </div>
    
    <!-- Cart & Orders Modal -->
    <div id="cart-modal-overlay">
        <div class="cart-modal-content">
            <div class="cart-modal-header">
                <div class="auth-tabs">
                    <div class="auth-tab active" data-tab="shopping-cart" data-lang-key="cart-title">আপনার শপিং কার্ট</div>
                    <div class="auth-tab" data-tab="order-history" data-lang-key="order-history">অর্ডার ইতিহাস</div>
                </div>
                <span class="auth-modal-close" id="cart-modal-close">&times;</span>
            </div>

            <!-- Shopping Cart View -->
            <div id="shopping-cart-view" class="auth-view active">
                <div id="cart-items-list" class="cart-items-list">
                    <!-- Cart items will be injected here by JS -->
                </div>
                <div id="empty-cart-message" style="display: none;">
                    <p data-lang-key="empty-cart">আপনার কার্ট খালি।</p>
                </div>
                <div id="cart-footer" style="display: none;">
                    <div class="cart-summary">
                        <div class="summary-row">
                            <span data-lang-key="subtotal">সাবটোটাল:</span>
                            <span id="cart-subtotal-price"></span>
                        </div>
                        <div class="summary-row" id="delivery-charge-row" style="display: none;">
                            <span data-lang-key="delivery-charge">ডেলিভারি চার্জ:</span>
                            <span id="cart-delivery-charge"></span>
                        </div>
                    </div>
                    <div class="summary-row cart-total">
                        <span data-lang-key="total-price">সর্বমোট:</span>
                        <span id="cart-total-price"></span>
                    </div>
                    <button id="checkout-btn" class="checkout-btn" data-lang-key="checkout">চেকআউট</button>
                </div>
            </div>
            
            <!-- Order History View (Inside Cart Modal) -->
            <div id="order-history-cart-view" class="auth-view" style="max-height: 400px; overflow-y: auto;">
                 <div id="orders-list-cart" class="orders-list">
                         <!-- Orders will be dynamically injected here -->
                 </div>
            </div>
        </div>
    </div>
    
    <!-- Payment Modal -->
    <div id="payment-modal-overlay" class="modal-overlay">
        <div class="auth-modal-content">
             <span class="auth-modal-close" id="payment-modal-close">&times;</span>
             <h3 data-lang-key="payment-title">পেমেন্ট পদ্ধতি নির্বাচন করুন</h3>
             <div class="payment-options">
                 <div class="payment-option" data-method="card">
                     <strong data-lang-key="payment-card">কার্ড</strong>
                     <div class="sub-options">
                          <div class="form-group">
                              <label for="card-name" data-lang-key="card-name-label">কার্ডে থাকা নাম</label>
                              <input type="text" id="card-name" placeholder="Abul Kalam">
                          </div>
                          <div class="form-group">
                               <label data-lang-key="card-number-label">কার্ড নম্বর</label>
                               <input type="text" placeholder="1234 5678 9101 1121">
                          </div>
                          <div class="form-group" style="display: flex; gap: 10px;">
                              <div style="flex: 1;">
                                   <label data-lang-key="expiry-label">মেয়াদ</label>
                                   <input type="text" placeholder="MM/YY">
                              </div>
                              <div style="flex: 1;">
                                   <label data-lang-key="cvc-label">CVC</label>
                                   <input type="text" placeholder="123">
                              </div>
                          </div>
                     </div>
                 </div>
                 <div class="payment-option" data-method="mobile">
                     <strong data-lang-key="payment-mobile">মোবাইল ব্যাংকিং</strong>
                     <div class="sub-options">
                          <input type="radio" id="bkash" name="mobile-banking" value="Bkash" checked>
                          <label for="bkash">Bkash</label><br>
                          <input type="radio" id="nagad" name="mobile-banking" value="Nagad">
                          <label for="nagad">Nagad</label>
                     </div>
                 </div>
                  <div class="payment-option" data-method="cod">
                      <strong data-lang-key="cod">ক্যাশ অন ডেলিভারি</strong>
                  </div>
             </div>
             <button id="confirm-order-btn" class="auth-btn" data-lang-key="confirm-order-btn">অর্ডার নিশ্চিত করুন</button>
        </div>
    </div>
    
    <!-- Order Success Modal -->
    <div id="order-success-modal-overlay" class="modal-overlay">
        <div class="auth-modal-content">
             <span class="auth-modal-close" id="order-success-modal-close">&times;</span>
             <div class="success-icon">✔</div>
             <h3 data-lang-key="order-success">আপনার অর্ডারটি সফলভাবে সম্পন্ন হয়েছে!</h3>
             <p data-lang-key="order-success-msg">আমরা আপনার অর্ডারটি গ্রহণ করেছি। একটি কনফার্মেশন ইমেইল পাঠানো হয়েছে।</p>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div id="confirmation-modal-overlay" class="modal-overlay">
        <div class="auth-modal-content" style="max-width: 450px; text-align: center;">
            <h3 id="confirmation-title" data-lang-key="confirm-title">নিশ্চিত করুন</h3>
            <p id="confirmation-message" style="margin: 20px 0;"></p>
            <div style="display: flex; gap: 15px; justify-content: center;">
                <button id="confirm-no-btn" class="auth-btn" style="background-color: var(--text-light); flex-grow: 1;" data-lang-key="confirm-no">না</button>
                <button id="confirm-yes-btn" class="auth-btn" style="flex-grow: 1;" data-lang-key="confirm-yes">হ্যাঁ</button>
            </div>
        </div>
    </div>

    <!-- ফুটার সেকশন -->
    <footer class="main-footer">
        <div class="container">
            <div class="footer-grid">
                <div class="footer-col">
                    <h4>TangailBuzz</h4>
                    <p data-lang-key="footer-desc">বাংলাদেশের সেরা ই-কমার্স প্ল্যাটফর্ম। আপনার প্রয়োজনীয় সবকিছু এক জায়গায়।</p>
                    <div class="payment-methods">
                        <span>Visa</span><span>MC</span><span>AE</span><span>Nagad</span><span>SC</span>
                    </div>
                </div>
                <div class="footer-col">
                    <h4 data-lang-key="footer-links-title">দ্রুত লিঙ্ক</h4>
                    <ul>
                        <li><a id="footer-home" data-lang-key="nav-home">হোম</a></li><li><a id="footer-products" data-lang-key="nav-products">পণ্য</a></li><li><a data-lang-key="nav-offer">অফার</a></li><li><a id="footer-about" data-lang-key="nav-about">আমাদের সম্পর্কে</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h4 data-lang-key="footer-contact-title">যোগাযোগ</h4>
                    <ul class="contact-info">
                        <li><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg> <a href="https://mail.google.com/mail/u/2/#inbox" target="_blank">tangailbuzz.bd@gmail.com</a></li>
                        <li><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path></svg> <a href="tel:+8801863205976" style="color: #A0AEC0; text-decoration: none;">+8801863205976</a></li>
                        <li><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></svg> <a href="https://www.google.com/maps/place/Tangail+District" target="_blank" style="color: #A0AEC0; text-decoration: none;" data-lang-key="location">টাঙ্গাইল, বাংলাদেশ</a></li>
                    </ul>
                    <div class="social-links">
                        <a href="https://www.facebook.com/Tangailbuzz/" target="_blank"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"></path></svg></a>
                        <a href="#"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path><line x1="17.5" y1="6.5" x2="17.51" y2="6.5"></line></svg></a>
                        <a href="#"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path><polygon points="9.75 15.02 15.5 11.75 9.75 8.48 9.75 15.02"></polygon></svg></a>
                        <a href="#"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22.54 6.42a2.78 2.78 0 0 0-1.94-2C18.88 4 12 4 12 4s-6.88 0-8.6.46a2.78 2.78 0 0 0-1.94 2A29 29 0 0 0 1 11.75a29 29 0 0 0 .46 5.33A2.78 2.78 0 0 0 3.4 19c1.72.46 8.6.46 8.6.46s6.88 0 8.6-.46a2.78 2.78 0 0 0 1.94-2A29 29 0 0 0 23 11.75a29 29 0 0 0-.46-5.33z"></path><polygon points="9.75 15.02 15.5 11.75 9.75 8.48 9.75 15.02"></polygon></svg></a>
                    </div>
                </div>
            </div>
            <div class="footer-bottom">
                <p data-lang-key="footer-copyright">&copy; ২০২৫ TangailBuzz - সকল অধিকার সংরক্ষিত</p>
            </div>
        </div>
    </footer>
    
    <script type="module">
        // Firebase SDKs - Updated to a newer version for better features and security.
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { 
            getAuth, 
            createUserWithEmailAndPassword,
            signInWithEmailAndPassword,
            signInWithPopup,
            GoogleAuthProvider,
            sendPasswordResetEmail,
            onAuthStateChanged,
            signOut,
            updateProfile,
            deleteUser
        } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
        import { 
            getFirestore, 
            doc, 
            setDoc,
            getDoc,
            updateDoc,
            collection,
            addDoc,
            serverTimestamp,
            query,
            where,
            getDocs,
            deleteDoc,
            onSnapshot,
            orderBy,
            arrayUnion
        } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

        // Firebase Configuration (Using your provided config)
        const firebaseConfig = {
          apiKey: "AIzaSyDiPflpWTpsyUUyisSMV6R0eMtK6Hw4nCU",
          authDomain: "tangail-buzz.firebaseapp.com",
          projectId: "tangail-buzz",
          storageBucket: "tangail-buzz.appspot.com",
          messagingSenderId: "804162460618",
          appId: "1:804162460618:web:c8d8fd4ef3fbadc2b0cd33"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const googleProvider = new GoogleAuthProvider();

        document.addEventListener('DOMContentLoaded', function () {
            // This is the global store for all products fetched from the database
            let allProducts = [];

            // This object is now only for static UI text, not for dynamic product names.
            const translations = {
                'bn': {
                    'nav-home': 'হোম', 'nav-products': 'পণ্য', 'nav-offer': 'অফার', 'nav-about': 'আমাদের সম্পর্কে', 'search-placeholder': 'পণ্য খুঁজুন...',
                    'showcase-h1': 'TangailBuzz এ আপনাকে স্বাগতম', 'showcase-p': 'বাংলাদেশের সেরা ই-কমার্স প্ল্যাটফর্ম। আপনার প্রয়োজনীয় সবকিছু এক জায়গায়।',
                    'cta-button': 'শপিং শুরু করুন', 'categories-h2': 'আমাদের ক্যাটাগরি সমূহ', 'cat-all': 'সব পণ্য', 'cat-electronics': 'ইলেকট্রনিক্স',
                    'cat-fashion': 'পোশাক', 'cat-cosmetics': 'কসমেটিক', 'cat-household': 'গৃহস্থালী', 'cat-toys': 'খেলনা', 'cat-books': 'বই',
                    'tag-offer': 'অফার', 'off-text': 'ছাড়', 'tag-available': 'উপলব্ধ', 'tag-unofficial': 'আনঅফিসিয়াল', 'brand': 'ব্র্যান্ড', 'category': 'ক্যাটাগরি',
                    'product-id': 'প্রোডাক্ট আইডি', 'btn-details': 'বিস্তারিত', 'btn-add-cart': 'কার্টে যোগ করুন', 
                    'about-h2': 'আমাদের পথচলার গল্প',
                    'about-p1': '২০২৫ সালে TangailBuzz তার আনুষ্ঠানিক যাত্রা শুরু করে। টাঙ্গাইল বাংলাদেশের ঐতিহ্যের প্রাণকেন্দ্র, আর সেই ঐতিহ্য ও আধুনিকতার সমন্বয় ঘটিয়ে আমরা এই উদ্যোগের সূচনা করেছি। আমাদের স্বপ্ন ছিল—শুধু টাঙ্গাইল নয়, দেশের প্রতিটি প্রান্তের মানুষ যেন ঘরে বসেই টাঙ্গাইলের আসল পণ্য ও বিশ্বের সাথে সামঞ্জস্যপূর্ণ আধুনিক জিনিসপত্র পেতে পারে।',
                    'about-p2': 'শুরুটা ছোট আকারে হলেও খুব অল্প সময়ের মধ্যেই আমরা গ্রাহকদের বিশ্বাস অর্জন করতে পেরেছি। আমাদের কাছে গ্রাহক শুধু ক্রেতা নন, বরং একজন পরিবার-সদস্য। তাদের সন্তুষ্টি ও আস্থা অর্জনই আমাদের মূল শক্তি।',
                    'about-list-title': 'আমরা যা সরবরাহ করি',
                    'about-list-item1': 'ইলেকট্রনিক্স: দৈনন্দিন জীবনের প্রয়োজনীয় গ্যাজেট থেকে শুরু করে হোম অ্যাপ্লায়েন্স।',
                    'about-list-item2': 'পোশাক ও শাড়ি: টাঙ্গাইলের বিখ্যাত শাড়ি সহ দেশীয় ও আধুনিক পোশাক।',
                    'about-list-item3': 'কসমেটিকস ও ফ্যাশন আইটেম: বিশ্বমানের প্রসাধনী ও ফ্যাশন পণ্য।',
                    'about-list-item4': 'গৃহস্থালীর সামগ্রী: রান্নাঘর, সাজসজ্জা ও পরিবারের প্রয়োজনীয় সব কিছু।',
                    'about-p3': 'TangailBuzz কেবল একটি ই-কমার্স নয়, এটি টাঙ্গাইলের গর্ব, বাংলাদেশের আস্থার প্রতীক। আমরা বিশ্বাস করি, ঐতিহ্য আর আধুনিকতার মেলবন্ধন ঘটিয়ে TangailBuzz আগামী দিনে দেশের অন্যতম সেরা অনলাইন শপিং প্ল্যাটফর্ম হিসেবে প্রতিষ্ঠিত হবে।',
                    'founder-title': 'টাঙ্গাইলবাজের প্রতিষ্ঠাতা', 'modal-specs-title': 'বিস্তারিত তথ্য', 'modal-rating-text': 'রেটিং',
                    'footer-desc': 'বাংলাদেশের সেরা ই-কমার্স প্ল্যাটফর্ম। আপনার প্রয়োজনীয় সবকিছু এক জায়গায়।', 'footer-links-title': 'দ্রুত লিঙ্ক',
                    'footer-contact-title': 'যোগাযোগ', 'location': 'টাঙ্গাইল, বাংলাদেশ', 'footer-copyright': '© ২০২৫ TangailBuzz - সকল অধিকার সংরক্ষিত',
                    'auth-login-tab': 'লগইন', 'auth-register-tab': 'রেজিস্টার', 'login-title': 'আপনার একাউন্টে লগইন করুন', 'email-label': 'ইমেইল', 'password-label': 'পাসওয়ার্ড',
                    'login-btn': 'লগইন', 'forgot-password-link': 'পাসওয়ার্ড ভুলে গেছেন?', 'register-title': 'নতুন একাউন্ট তৈরি করুন', 'register-btn': 'রেজিস্টার',
                    'google-login-btn': 'গুগল দিয়ে লগইন করুন', 'forgot-password-title': 'পাসওয়ার্ড রিসেট', 'reset-password-btn': 'রিসেট লিঙ্ক পাঠান',
                    'back-to-login-link': '« লগইনে ফিরে যান', 'manage-address': 'ঠিকানা পরিচালনা করুন', 'logout': 'লগআউট', 'address-title': 'আমার ডিফল্ট ঠিকানা',
                    'address-line1-label': 'ঠিকানা', 'address-city-label': 'শহর', 'address-postal-label': 'পোস্টাল কোড', 'save-address-btn': 'ঠিকানা সংরক্ষণ করুন',
                    'back-to-account-link': '« একাউন্টে ফিরে যান', 'user-greeting': 'স্বাগতম,', 'my-account-title': 'আমার একাউন্ট', 'name-label': 'নাম',
                    'mobile-label': 'মোবাইল', 'address-label': 'ঠিকানা', 'retype-password-label': 'পুনরায় পাসওয়ার্ড দিন', 'password-mismatch': 'পাসওয়ার্ড মেলেনি!',
                    'password-reset-success': 'পাসওয়ার্ড রিসেট লিঙ্ক পাঠানো হয়েছে! আপনার ইমেইল ইনবক্স বা স্প্যাম ফোল্ডার চেক করুন।', 'cart-title': 'আপনার শপিং কার্ট',
                    'empty-cart': 'আপনার কার্ট খালি।', 'total-price': 'সর্বমোট:', 'checkout': 'চেকআউট', 'payment-title': 'পেমেন্ট পদ্ধতি নির্বাচন করুন',
                    'payment-card': 'কার্ড', 'payment-mobile': 'মোবাইল ব্যাংকিং', 'cod': 'ক্যাশ অন ডেলিভারি', 'confirm-order-btn': 'অর্ডার নিশ্চিত করুন', 'order-success': 'আপনার অর্ডারটি সফলভাবে সম্পন্ন হয়েছে!',
                    'order-success-msg': 'আমরা আপনার অর্ডারটি গ্রহণ করেছি। একটি কনফার্মেশন ইমেইল পাঠানো হয়েছে।', 'subtotal': 'সাবটোটাল:', 'delivery-charge': 'ডেলিভারি চার্জ:',
                    'card-name-label': 'কার্ডে থাকা নাম', 'change-mobile': 'মোবাইল নম্বর পরিবর্তন করুন', 'mobile-title': 'মোবাইল নম্বর পরিবর্তন', 'save-mobile-btn': 'সংরক্ষণ করুন',
                    'delete-account': 'একাউন্ট মুছে ফেলুন', 'account-deleted': 'আপনার একাউন্ট সফলভাবে মুছে ফেলা হয়েছে।',
                    'order-history': 'অর্ডার ইতিহাস', 'order-history-title': 'আমার অর্ডারসমূহ', 'invoice-btn': 'ইনভয়েস ডাউনলোড', 'no-orders': 'এখনও কোনো অর্ডার করা হয়নি।',
                    'confirm-title': 'নিশ্চিত করুন', 'confirm-yes': 'হ্যাঁ', 'confirm-no': 'না', 'confirm-delete': 'আপনি কি নিশ্চিতভাবে আপনার একাউন্ট মুছে ফেলতে চান? এই কাজটি আর ফেরানো যাবে না।',
                    'processing-btn': 'প্রসেস হচ্ছে...', 'name-not-found': 'নাম পাওয়া যায়নি', 'no-description': 'কোনো বিবরণ নেই',
                    'showcase-h1-2': 'সেরা ফ্যাশন কালেকশন', 'showcase-p-2': 'আধুনা থেকে ঐতিহ্যবাহী, সবই পাবেন এখানে।',
                    'showcase-h1-3': 'লেটেস্ট ইলেকট্রনিক্স', 'showcase-p-3': 'আপনার জীবনকে করুন আরও সহজ ও আধুনিক।',
                    'showcase-h1-4': 'গৃহস্থালীর প্রয়োজনীয় জিনিস', 'showcase-p-4': 'আপনার ঘর সাজাতে প্রয়োজনীয় সবকিছু।',
                    'showcase-h1-5': 'বিউটি ও কসমেটিকস', 'showcase-p-5': 'Enhance your beauty with our best products.',
                    'showcase-h1-6': 'বইয়ের বিশাল সংগ্রহ', 'showcase-p-6': 'জ্ঞান ও বিনোদনের সেরা সম্ভার।',
                    'write-review-title': 'আপনার রিভিউ লিখুন',
                    'review-placeholder-text': 'আপনার মতামত...',
                    'review-submit-btn': 'জমা দিন',
                    'reviews-heading': 'রিভিউ',
                    'no-reviews': 'কোনো রিভিউ নেই। আপনি প্রথম রিভিউ দিন!'
                },
                'en': {
                    'nav-home': 'Home', 'nav-products': 'Products', 'nav-offer': 'Offers', 'nav-about': 'About Us', 'search-placeholder': 'Search products...',
                    'showcase-h1': 'Welcome to TangailBuzz', 'showcase-p': 'The best e-commerce platform in Bangladesh. Everything you need in one place.',
                    'cta-button': 'Start Shopping', 'categories-h2': 'Our Categories', 'cat-all': 'All Products', 'cat-electronics': 'Electronics',
                    'cat-fashion': 'Fashion', 'cat-cosmetics': 'Cosmetics', 'cat-household': 'Household', 'cat-toys': 'Toys', 'cat-books': 'Books',
                    'tag-offer': 'Offer', 'off-text': 'Off', 'tag-available': 'AVAILABLE', 'tag-unofficial': 'UNOFFICIAL', 'brand': 'Brand', 'category': 'Category',
                    'product-id': 'Product ID', 'btn-details': 'Details', 'btn-add-cart': 'Add to Cart', 
                    'about-h2': 'Our Journey',
                    'about-p1': "TangailBuzz officially started its journey in 2025. Tangail is the heart of Bangladesh's heritage, and we initiated this venture by combining that tradition with modernity. Our dream was not just for Tangail, but for people from every corner of the country to get authentic Tangail products and modern goods compatible with the world, right at their doorstep.",
                    'about-p2': "Although we started small, we have earned our customers' trust in a very short time. To us, a customer is not just a buyer but a family member. Their satisfaction and trust are our main strengths.",
                    'about-list-title': 'What We Provide',
                    'about-list-item1': 'Electronics: From daily life gadgets to home appliances.',
                    'about-list-item2': 'Clothing & Sarees: Including the famous sarees of Tangail, along with local and modern attire.',
                    'about-list-item3': 'Cosmetics & Fashion Items: World-class beauty and fashion products.',
                    'about-list-item4': 'Household Items: Everything needed for the kitchen, decoration, and family.',
                    'about-p3': "TangailBuzz is not just an e-commerce platform; it's the pride of Tangail and a symbol of trust in Bangladesh. We believe that by blending tradition and modernity, TangailBuzz will establish itself as one of the country's leading online shopping platforms in the coming days.",
                    'founder-title': 'Founder of TangailBuzz', 'modal-specs-title': 'Specifications', 'modal-rating-text': 'Ratings',
                    'footer-desc': 'The best e-commerce platform in Bangladesh. Everything you need in one place.', 'footer-links-title': 'Quick Links',
                    'footer-contact-title': 'Contact', 'location': 'Tangail, Bangladesh', 'footer-copyright': '© 2025 TangailBuzz - All rights reserved',
                    'auth-login-tab': 'Login', 'auth-register-tab': 'Register', 'login-title': 'Login to your account', 'email-label': 'Email', 'password-label': 'Password',
                    'login-btn': 'Login', 'forgot-password-link': 'Forgot password?', 'register-title': 'Create a new account', 'register-btn': 'Register',
                    'google-login-btn': 'Login with Google', 'forgot-password-title': 'Reset Password', 'reset-password-btn': 'Send Reset Link',
                    'back-to-login-link': '« Back to Login', 'manage-address': 'Manage Address', 'logout': 'Logout', 'address-title': 'My Default Address',
                    'address-line1-label': 'Address', 'address-city-label': 'City', 'address-postal-label': 'Postal Code', 'save-address-btn': 'Save Address',
                    'back-to-account-link': '« Back to Account', 'user-greeting': 'Welcome,', 'my-account-title': 'My Account', 'name-label': 'Name',
                    'mobile-label': 'Mobile', 'address-label': 'Address', 'retype-password-label': 'Retype Password', 'password-mismatch': 'Passwords do not match!',
                    'password-reset-success': 'Password reset link sent! Please check your email inbox or spam folder.', 'cart-title': 'Your Shopping Cart',
                    'empty-cart': 'Your cart is empty.', 'total-price': 'Total:', 'checkout': 'Checkout', 'payment-title': 'Select Payment Method',
                    'payment-card': 'Card', 'payment-mobile': 'Mobile Banking', 'cod': 'Cash on Delivery', 'confirm-order-btn': 'Confirm Order', 'order-success': 'Your order has been placed successfully!',
                    'order-success-msg': 'We have received your order. A confirmation email has been sent.', 'subtotal': 'Subtotal:', 'delivery-charge': 'Delivery Charge:',
                    'card-name-label': 'Name on Card', 'change-mobile': 'Change Mobile Number', 'mobile-title': 'Change Mobile Number', 'save-mobile-btn': 'Save',
                    'delete-account': 'Delete Account', 'account-deleted': 'Your account has been successfully deleted.',
                    'order-history': 'Order History', 'order-history-title': 'My Orders', 'invoice-btn': 'Download Invoice', 'no-orders': 'You have not placed any orders yet.',
                    'confirm-title': 'Confirm Action', 'confirm-yes': 'Yes', 'confirm-no': 'Cancel', 'confirm-delete': 'Are you sure you want to delete your account? This action cannot be undone.',
                    'processing-btn': 'Processing...', 'name-not-found': 'Name Not Found', 'no-description': 'No description available',
                    'showcase-h1-2': 'Best Fashion Collection', 'showcase-p-2': 'From modern to traditional, find it all here.',
                    'showcase-h1-3': 'Latest Electronics', 'showcase-p-3': 'Make your life easier and more modern.',
                    'showcase-h1-4': 'Household Essentials', 'showcase-p-4': 'Everything you need to decorate your home.',
                    'showcase-h1-5': 'Beauty & Cosmetics', 'showcase-p-5': 'Enhance your beauty with our best products.',
                    'showcase-h1-6': 'Huge Collection of Books', 'showcase-p-6': 'The best collection of knowledge and entertainment.',
                    'write-review-title': 'Write a Review',
                    'review-placeholder-text': 'Your review...',
                    'review-submit-btn': 'Submit',
                    'reviews-heading': 'Reviews',
                    'no-reviews': 'No reviews yet. Be the first to write one!'
                }
            };
            
            const body = document.body;

            // Language Switcher Logic
            const dropdown = document.querySelector('.language-dropdown');
            const selectedLangBtn = dropdown.querySelector('.selected-lang');
            const langOptions = dropdown.querySelectorAll('.lang-option');

            const bengaliDigits = ['০', '১', '২', '৩', '৪', '৫', '৬', '৭', '৮', '৯'];
            function formatPrice(price, lang) {
                if (price === undefined || price === null) return '';
                const number = parseInt(price);
                const formattedNumber = number.toLocaleString('en-IN'); // For comma style like 1,05,000
                if (lang === 'bn') {
                    return '৳ ' + formattedNumber.split('').map(digit => bengaliDigits[digit] || digit).join('');
                }
                return '৳ ' + formattedNumber;
            }

            function setLanguage(lang) {
                document.querySelectorAll('[data-lang-key]').forEach(element => {
                    const key = element.getAttribute('data-lang-key');
                    if (translations[lang] && translations[lang][key]) {
                        if (element.tagName === 'INPUT' && (element.type === 'text' || element.type === 'email' || element.type === 'password' || element.type === 'tel')) {
                            element.placeholder = translations[lang][key];
                        } else {
                            element.textContent = translations[lang][key];
                        }
                    }
                });
                
                updateCartUI();

                body.classList.toggle('lang-en', lang === 'en');
                const selectedOption = dropdown.querySelector(`.lang-option[data-lang="${lang}"]`);
                if(selectedOption) selectedLangBtn.innerHTML = selectedOption.innerHTML;
                localStorage.setItem('language', lang);
                // Also update the dynamically rendered products if they exist
                if(allProducts.length > 0) {
                    renderProducts(allProducts);
                    filterAndSearchProducts();
                }
            }
            
            selectedLangBtn.addEventListener('click', () => dropdown.classList.toggle('open'));
            langOptions.forEach(option => {
                option.addEventListener('click', () => {
                    setLanguage(option.dataset.lang);
                    dropdown.classList.remove('open');
                });
            });
            window.addEventListener('click', (e) => {
                if (!dropdown.contains(e.target)) dropdown.classList.remove('open');
            });

            // Theme Toggle Logic
            const themeToggleBtn = document.getElementById('theme-toggle-btn');
            if (localStorage.getItem('theme') === 'dark') body.classList.add('dark-mode');
            themeToggleBtn.addEventListener('click', () => {
                body.classList.toggle('dark-mode');
                localStorage.setItem('theme', body.classList.contains('dark-mode') ? 'dark' : 'light');
            });

            // Page Navigation & Content Toggling
            const navProducts = document.getElementById('nav-products');
            const navOffer = document.getElementById('nav-offer');
            const navAbout = document.getElementById('nav-about');
            const mainContentWrapper = document.getElementById('main-content-wrapper');
            const aboutUsSection = document.getElementById('about-us');
            const logo = document.querySelector('.logo');
            const footerHome = document.getElementById('footer-home');
            const footerProducts = document.getElementById('footer-products');
            const footerAbout = document.getElementById('footer-about');
            
            function showMainContent() {
                mainContentWrapper.style.display = 'block';
                aboutUsSection.style.display = 'none';
            }
            function showAboutSection() {
                mainContentWrapper.style.display = 'none';
                aboutUsSection.style.display = 'block';
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }

            [logo, footerHome].forEach(el => el.addEventListener('click', showMainContent));
            [navAbout, footerAbout].forEach(el => el.addEventListener('click', showAboutSection));
            
            document.querySelectorAll('.cta-button, #nav-products, #footer-products').forEach(el => {
                el.addEventListener('click', (e) => {
                    e.preventDefault();
                    showMainContent();
                    document.querySelector('.filter-btn[data-filter="all"]').click();
                    const target = document.getElementById('categories');
                    if(target) window.scrollTo({ top: target.offsetTop - 70, behavior: 'smooth' });
                });
            });

            navOffer.addEventListener('click', () => {
                showMainContent();
                filterButtons.forEach(btn => btn.classList.remove('active'));
                const filtered = allProducts.filter(p => p.isOffer === true);
                renderProducts(filtered);

                const target = document.getElementById('categories');
                if(target) window.scrollTo({ top: target.offsetTop - 70, behavior: 'smooth' });
            });

            // Search and Filter Logic
            const filterButtons = document.querySelectorAll('.filter-btn');
            const searchInput = document.getElementById('searchInput');

            function filterAndSearchProducts() {
                const searchQuery = searchInput.value.toLowerCase();
                const activeFilterBtn = document.querySelector('.filter-btn.active');
                if (!activeFilterBtn) return;
                const activeFilter = activeFilterBtn.getAttribute('data-filter');
                const currentLang = localStorage.getItem('language') || 'bn';

                const filteredProducts = allProducts.filter(product => {
                    // Check for multiple name fields
                    const nameBn = product.productNameBn || product.name?.bn || '';
                    const nameEn = product.productNameEn || product.name?.en || '';
                    const productName = (currentLang === 'bn' ? nameBn : nameEn).toLowerCase();
                    
                    const categoryMatch = (activeFilter === 'all' || activeFilter === (product.category || "").toLowerCase());
                    const searchMatch = productName.includes(searchQuery);

                    return categoryMatch && searchMatch;
                });
                renderProducts(filteredProducts);
            }
            filterButtons.forEach(button => button.addEventListener('click', function () {
                filterButtons.forEach(btn => btn.classList.remove('active'));
                this.classList.add('active');
                filterAndSearchProducts();
            }));
            if(searchInput) searchInput.addEventListener('keyup', filterAndSearchProducts);

            // Product Details Modal Logic
            const modalOverlay = document.getElementById('product-details-modal');
            const modalCloseBtn = document.getElementById('modal-close-btn');
            
            function getSpecIcon(key) {
                const lowerKey = key.toLowerCase();
                if (lowerKey.includes('released') || lowerKey.includes('প্রকাশিত')) return `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>`;
                if (lowerKey.includes('os') || lowerKey.includes('ওএস')) return `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 18a2 2 0 0 0-2-2H9a2 2 0 0 0-2 2"></path><path d="M12 14v4"></path><path d="M16 11V7a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v4"></path><path d="m11 5 2 2"></path><path d="m5 11 2-2"></path></svg>`;
                if (lowerKey.includes('display') || lowerKey.includes('ডিসপ্লে')) return `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="5" y="2" width="14" height="20" rx="2" ry="2"></rect><line x1="12" y1="18" x2="12.01" y2="18"></line></svg>`;
                if (lowerKey.includes('camera') || lowerKey.includes('ক্যামেরা')) return `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path><circle cx="12" cy="13" r="4"></circle></svg>`;
                if (lowerKey.includes('ram') || lowerKey.includes('র‍্যাম')) return `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 12h20"></path><path d="M5 12v6"></path><path d="M19 12v6"></path><path d="M2 18h20"></path><path d="M5 6v6"></path><path d="M19 6v6"></path><path d="M2 6h20"></path></svg>`;
                if (lowerKey.includes('battery') || lowerKey.includes('ব্যাটারি')) return `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="1" y="6" width="18" height="12" rx="2" ry="2"></rect><line x1="23" y1="13" x2="23" y2="11"></line></svg>`;
                return `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>`;
            }

            // Centralized function to get product data based on language
            function getLocalizedProductData(product, lang) {
                const isBn = lang === 'bn';
                // Prioritize specific language fields, then generic ones
                const name = isBn ? product.productNameBn || product.name?.bn || translations[lang]['name-not-found'] : product.productNameEn || product.name?.en || translations[lang]['name-not-found'];
                const description = isBn ? product.descriptionBengali || product.descriptionBn || translations[lang]['no-description'] : product.descriptionEnglish || product.descriptionEn || translations[lang]['no-description'];
                const brand = isBn ? product.brandBengali || product.brand?.bn || 'N/A' : product.brandEnglish || product.brand?.en || 'N/A';
                const category = translations[lang][`cat-${(product.category || "").toLowerCase()}`] || product.category;
                const price = product.offerPrice || product.price;
                const oldPrice = product.offerPrice ? product.price : product.oldPrice;
                const rating = parseFloat(product.rating) || 0;
                const mainImage = product.mainImageURL || product.imageUrl || (product.img && product.img.main) || 'https://placehold.co/400x400/F0F0F0/333?text=Image+Not+Found';
                const thumbnails = (product.thumbnails && Array.isArray(product.thumbnails)) ? product.thumbnails : [];

                // Combine different specification fields into a single object
                let specs = {};
                // Handle sizes
                if (product.sizes && Array.isArray(product.sizes) && product.sizes.length > 0) {
                    const sizesKey = isBn ? 'সাইজ' : 'Sizes';
                    specs[sizesKey] = product.sizes.join(', ');
                }
                // Handle general specifications
                if (product.specifications) {
                    for (const key in product.specifications) {
                        const specValue = product.specifications[key];
                        const translatedKey = isBn ? translations[lang][key.toLowerCase()] || key : key;
                        specs[translatedKey] = specValue;
                    }
                }
                
                return {
                    name,
                    description,
                    brand,
                    category,
                    price,
                    oldPrice,
                    rating,
                    mainImage,
                    thumbnails,
                    specs
                };
            }


            function openProductModal(productId) {
                const product = allProducts.find(p => p.id === productId);
                if (!product) return;

                const currentLang = localStorage.getItem('language') || 'bn';
                const data = getLocalizedProductData(product, currentLang);
                
                document.getElementById('modal-product-id').textContent = product.id;
                document.getElementById('modal-product-name').textContent = data.name;
                document.getElementById('modal-product-price').textContent = formatPrice(data.price, currentLang);
                document.getElementById('modal-brand').textContent = data.brand;
                document.getElementById('modal-category').textContent = data.category;
                document.getElementById('modal-product-description').textContent = data.description;
                
                const ratingTextKey = 'modal-rating-text';
                document.getElementById('modal-rating-text').textContent = `(${data.rating} ${translations[currentLang][ratingTextKey]})`;
                
                const specList = document.getElementById('modal-spec-list');
                const specsHeading = document.querySelector('.modal-details h3[data-lang-key="modal-specs-title"]');
                specList.innerHTML = '';
                
                if (Object.keys(data.specs).length > 0) {
                    if(specsHeading) specsHeading.style.display = 'block';
                    for (const key in data.specs) {
                        const value = data.specs[key];
                        specList.innerHTML += `<li><div class="spec-icon">${getSpecIcon(key)}</div><div class="spec-text"><span class="spec-key">${key}</span><span class="spec-value">${value}</span></div></li>`;
                    }
                } else {
                    if(specsHeading) specsHeading.style.display = 'none';
                }

                const mainImageEl = document.getElementById('modal-main-image');
                mainImageEl.src = data.mainImage;
                const thumbnailsContainer = document.getElementById('modal-thumbnails');
                thumbnailsContainer.innerHTML = '';
                
                const allDisplayImages = [data.mainImage, ...data.thumbnails].filter(Boolean);

                allDisplayImages.forEach((imgSrc, index) => {
                    const img = document.createElement('img');
                    img.src = imgSrc;
                    img.addEventListener('click', () => {
                        mainImageEl.src = imgSrc;
                        thumbnailsContainer.querySelectorAll('img').forEach(i => i.classList.remove('active'));
                        img.classList.add('active');
                    });
                    if (index === 0) img.classList.add('active');
                    thumbnailsContainer.appendChild(img);
                });
                
                document.getElementById('modal-add-to-cart-btn').dataset.productId = product.id;
                modalOverlay.classList.add('visible');
            }

            function closeModal(modalId) {
                document.getElementById(modalId).classList.remove('visible');
            }
            modalCloseBtn.addEventListener('click', () => closeModal('product-details-modal'));
            modalOverlay.addEventListener('click', e => { if (e.target === modalOverlay) closeModal('product-details-modal'); });

            // Auth Modal & Firebase Logic
            const authModal = document.getElementById('auth-modal-overlay');
            const authModalClose = document.getElementById('auth-modal-close');
            const profileBtn = document.getElementById('profile-btn');
            const authViews = document.querySelectorAll('.auth-view');
            
            const showView = (viewId) => {
                authViews.forEach(v => v.classList.remove('active'));
                document.getElementById(viewId)?.classList.add('active');
            };
            
            profileBtn.addEventListener('click', () => authModal.classList.add('visible'));
            authModalClose.addEventListener('click', () => closeModal('auth-modal-overlay'));
            authModal.addEventListener('click', e => { if(e.target === authModal) closeModal('auth-modal-overlay'); });

            // Tab switching
            document.querySelectorAll('.auth-tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    document.getElementById('login-form-container').style.display = tab.dataset.tab === 'login' ? 'block' : 'none';
                    document.getElementById('register-form-container').style.display = tab.dataset.tab === 'register' ? 'block' : 'none';
                });
            });

            // Navigation links inside auth modal
            document.getElementById('show-forgot-password').addEventListener('click', () => showView('forgot-password-view'));
            document.getElementById('back-to-login').addEventListener('click', () => showView('login-register-view'));
            document.getElementById('manage-address-btn').addEventListener('click', () => showView('address-view'));
            document.getElementById('change-mobile-btn').addEventListener('click', () => showView('mobile-view'));
            document.getElementById('order-history-btn').addEventListener('click', () => showView('order-history-view'));
            document.getElementById('back-to-account').addEventListener('click', () => showView('account-view'));
            document.getElementById('back-to-account-from-mobile').addEventListener('click', () => showView('account-view'));
            document.getElementById('back-to-account-from-history').addEventListener('click', () => showView('account-view'));


            const authMessageContainer = document.getElementById('auth-message-container');
            const showAuthMessage = (messageKey, isError = false, rawMessage = '') => {
                const currentLang = localStorage.getItem('language') || 'bn';
                authMessageContainer.textContent = translations[currentLang][messageKey] || rawMessage || messageKey;
                authMessageContainer.className = `auth-message ${isError ? 'error' : 'success'}`;
                setTimeout(() => authMessageContainer.textContent = '', 4000);
            };

            // Firebase Auth Handlers
            document.getElementById('register-form').addEventListener('submit', async (e) => {
                e.preventDefault();
                const name = document.getElementById('register-name').value;
                const mobile = document.getElementById('register-mobile').value;
                const address = document.getElementById('register-address').value;
                const email = document.getElementById('register-email').value;
                const password = document.getElementById('register-password').value;
                const retypePassword = document.getElementById('register-retype-password').value;
                
                if (password !== retypePassword) {
                    showAuthMessage('password-mismatch', true);
                    return;
                }

                try {
                    const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                    const user = userCredential.user;
                    
                    await updateProfile(user, { displayName: name });
                    
                    const userDocRef = doc(db, "users", user.uid);
                    await setDoc(userDocRef, {
                        name: name,
                        email: email,
                        mobile: mobile,
                        address: {
                            line1: address,
                            city: '',
                            postal: ''
                        }
                    });

                    showAuthMessage('Registration successful!');
                    closeModal('auth-modal-overlay');

                } catch (error) {
                    showAuthMessage(null, true, error.message);
                }
            });

            document.getElementById('login-form').addEventListener('submit', (e) => {
                e.preventDefault();
                const email = document.getElementById('login-email').value;
                const password = document.getElementById('login-password').value;
                signInWithEmailAndPassword(auth, email, password)
                    .then(userCredential => {
                        showAuthMessage('Login successful!');
                        closeModal('auth-modal-overlay');
                    })
                    .catch(error => showAuthMessage(null, true, error.message));
            });

            document.getElementById('google-signin-btn').addEventListener('click', () => {
                signInWithPopup(auth, googleProvider)
                    .then(async (result) => {
                        const user = result.user;
                        const userDocRef = doc(db, "users", user.uid);
                        const docSnap = await getDoc(userDocRef);
                        if (!docSnap.exists()) {
                            await setDoc(userDocRef, {
                                name: user.displayName,
                                email: user.email,
                                mobile: user.phoneNumber || '',
                                address: { line1: '', city: '', postal: '' }
                            });
                        }
                        showAuthMessage('Google sign-in successful!');
                        closeModal('auth-modal-overlay');
                    }).catch(error => showAuthMessage(null, true, error.message));
            });
            
            document.getElementById('forgot-password-form').addEventListener('submit', (e) => {
                e.preventDefault();
                const email = document.getElementById('forgot-email').value;
                sendPasswordResetEmail(auth, email)
                    .then(() => {
                        showAuthMessage('password-reset-success');
                        showView('login-register-view');
                    })
                    .catch(error => showAuthMessage(null, true, error.message));
            });

            document.getElementById('logout-btn').addEventListener('click', () => {
                signOut(auth).then(() => {
                    showAuthMessage('Logged out successfully.');
                    closeModal('auth-modal-overlay');
                }).catch(error => showAuthMessage(null, true, error.message));
            });
            
            // Confirmation Modal Logic
            const confirmationModal = document.getElementById('confirmation-modal-overlay');
            const confirmationMessage = document.getElementById('confirmation-message');
            const confirmYesBtn = document.getElementById('confirm-yes-btn');
            const confirmNoBtn = document.getElementById('confirm-no-btn');
            let confirmCallback = null;

            function showConfirmationModal(messageKey, onConfirm) {
                const currentLang = localStorage.getItem('language') || 'bn';
                confirmationMessage.textContent = translations[currentLang][messageKey] || messageKey;
                confirmCallback = onConfirm;
                confirmationModal.classList.add('visible');
            }

            confirmYesBtn.addEventListener('click', () => {
                if (confirmCallback) {
                    confirmCallback();
                }
                confirmationModal.classList.remove('visible');
            });

            confirmNoBtn.addEventListener('click', () => confirmationModal.classList.remove('visible'));
            confirmationModal.addEventListener('click', e => { if (e.target === confirmationModal) closeModal('confirmation-modal-overlay'); });

            document.getElementById('delete-account-btn').addEventListener('click', () => {
                const user = auth.currentUser;
                if (user) {
                    showConfirmationModal('confirm-delete', async () => {
                        try {
                            const userDocRef = doc(db, "users", user.uid);
                            // Also delete user's orders
                            const ordersQuery = query(collection(db, "orders"), where("userId", "==", user.uid));
                            const ordersSnapshot = await getDocs(ordersQuery);
                            const deletePromises = ordersSnapshot.docs.map(orderDoc => deleteDoc(orderDoc.ref));
                            await Promise.all(deletePromises);

                            // Delete user document and auth user
                            await deleteDoc(userDocRef);
                            await deleteUser(user);
                            showAuthMessage('account-deleted');
                            closeModal('auth-modal-overlay');
                        } catch (error) {
                            console.error("Error deleting account: ", error);
                            showAuthMessage(null, true, "Error: " + error.message);
                        }
                    });
                }
            });


            // Auth State Change Handler
            let unsubscribeOrders = null;
            onAuthStateChanged(auth, async (user) => {
                if (user) {
                    showView('account-view');
                     const userDocRef = doc(db, "users", user.uid);
                     const docSnap = await getDoc(userDocRef);
                     let name = user.email;
                     if (docSnap.exists() && docSnap.data().name) {
                         name = docSnap.data().name;
                     } else if (user.displayName) {
                         name = user.displayName;
                     }
                    document.getElementById('user-greeting').textContent = `${translations[localStorage.getItem('language') || 'bn']['user-greeting']} ${name}`;
                    await loadAddress(user.uid);
                    await loadMobile(user.uid);
                    if (unsubscribeOrders) unsubscribeOrders(); // Unsubscribe from previous listener
                    listenToOrders(user.uid);
                } else {
                    showView('login-register-view');
                    if (unsubscribeOrders) unsubscribeOrders(); // Unsubscribe on logout
                     // Reset to login tab
                    document.querySelector('.auth-tab[data-tab="login"]').click();
                }
            });

            // Address Management (Firestore)
            const addressForm = document.getElementById('address-form');
            const addressListDiv = document.getElementById('address-list');

            async function saveAddress(userId) {
                const addressData = {
                    line1: document.getElementById('address-line1').value,
                    city: document.getElementById('address-city').value,
                    postal: document.getElementById('address-postal').value,
                };
                try {
                    const userDocRef = doc(db, "users", userId);
                    await setDoc(userDocRef, { address: addressData }, { merge: true });
                    showAuthMessage('Address saved!');
                    loadAddress(userId);
                } catch (e) {
                    showAuthMessage('Error saving address: ' + e.message, true);
                }
            }

            async function loadAddress(userId) {
                try {
                    const userDocRef = doc(db, "users", userId);
                    const docSnap = await getDoc(userDocRef);
                    if (docSnap.exists() && docSnap.data().address) {
                        const data = docSnap.data().address;
                        addressListDiv.innerHTML = `<div class="address-item">${data.line1}, ${data.city || ''} - ${data.postal || ''}</div>`;
                        document.getElementById('address-line1').value = data.line1 || '';
                        document.getElementById('address-city').value = data.city || '';
                        document.getElementById('address-postal').value = data.postal || '';
                    } else {
                        addressListDiv.innerHTML = "<p>No address saved.</p>";
                    }
                } catch(e) {
                     addressListDiv.innerHTML = "<p>Could not load address.</p>";
                }
            }

            addressForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const user = auth.currentUser;
                if(user) {
                    saveAddress(user.uid);
                }
            });

            // Mobile Management
            const mobileForm = document.getElementById('mobile-form');

            async function saveMobile(userId) {
                const newMobile = document.getElementById('mobile-number').value;
                 try {
                     const userDocRef = doc(db, "users", userId);
                     await updateDoc(userDocRef, { mobile: newMobile });
                     showAuthMessage('Mobile number updated!');
                 } catch (e) {
                     showAuthMessage('Error updating mobile: ' + e.message, true);
                 }
            }

             async function loadMobile(userId) {
                 try {
                     const userDocRef = doc(db, "users", userId);
                     const docSnap = await getDoc(userDocRef);
                     if (docSnap.exists() && docSnap.data().mobile) {
                         document.getElementById('mobile-number').value = docSnap.data().mobile;
                     }
                 } catch(e) {
                      console.error("Could not load mobile number.");
                 }
            }

            mobileForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const user = auth.currentUser;
                if(user) {
                    saveMobile(user.uid);
                }
            });
            
            // Cart Logic
            const cartBtn = document.getElementById('cart-btn');
            const cartModal = document.getElementById('cart-modal-overlay');
            const cartModalClose = document.getElementById('cart-modal-close');
            const cartItemsList = document.getElementById('cart-items-list');
            const cartSubtotalPriceEl = document.getElementById('cart-subtotal-price');
            const cartDeliveryChargeEl = document.getElementById('cart-delivery-charge');
            const deliveryChargeRow = document.getElementById('delivery-charge-row');
            const cartTotalPriceEl = document.getElementById('cart-total-price');
            const cartCountEl = document.querySelector('.cart-count');
            const emptyCartMessage = document.getElementById('empty-cart-message');
            const cartFooter = document.getElementById('cart-footer');
            const checkoutBtn = document.getElementById('checkout-btn');
            
            let cart = JSON.parse(localStorage.getItem('shoppingCart')) || [];
            
            function saveCart() {
                localStorage.setItem('shoppingCart', JSON.stringify(cart));
                updateCartUI();
            }

            function addToCart(productId) {
                 const product = allProducts.find(p => p.id === productId);
                 if(!product) return;
                 const existingItem = cart.find(item => item.id === productId);
                 const imgSrc = product.mainImageURL || (product.img && product.img.main) || 'https://placehold.co/300x200/F0F0F0/333?text=Image+Not+Found';
                 
                 const nameBN = product.productNameBn || product.name?.bn || 'প্রোডাক্ট';
                 const nameEN = product.productNameEn || product.name?.en || 'Product';
                 const price = parseInt(product.offerPrice || product.price);

                 if (existingItem) {
                     existingItem.quantity++;
                 } else {
                     cart.push({ 
                         id: productId,
                         nameEN: nameEN,
                         nameBN: nameBN,
                         price: price, 
                         quantity: 1, 
                         img: imgSrc
                     });
                 }
                 saveCart();
            }
            
            document.getElementById('modal-add-to-cart-btn').addEventListener('click', (e) => {
                 const productId = e.target.dataset.productId;
                 addToCart(productId);
                 closeModal('product-details-modal');
            });
            
            function updateCartQuantity(productId, action) {
                const itemIndex = cart.findIndex(item => item.id === productId);
                if (itemIndex > -1) {
                    if (action === 'increase') {
                        cart[itemIndex].quantity++;
                    } else if (action === 'decrease') {
                        cart[itemIndex].quantity--;
                    }
                    
                    if(cart[itemIndex].quantity <= 0) {
                        cart.splice(itemIndex, 1);
                    }
                    saveCart();
                }
            }
            
            async function updateCartUI() {
                const currentLang = localStorage.getItem('language') || 'bn';
                
                if(cart.length === 0) {
                    cartItemsList.innerHTML = '';
                    emptyCartMessage.style.display = 'block';
                    cartFooter.style.display = 'none';
                } else {
                    emptyCartMessage.style.display = 'none';
                    cartFooter.style.display = 'block';
                    cartItemsList.innerHTML = cart.map(item => {
                        const name = currentLang === 'bn' ? item.nameBN : item.nameEN;
                        const price = formatPrice(item.price * item.quantity, currentLang);
                        return `
                            <div class="cart-item">
                                <img src="${item.img}" alt="${name}">
                                <div class="cart-item-details">
                                    <strong>${name}</strong>
                                     <div class="cart-item-quantity">
                                         <button class="quantity-btn" data-id="${item.id}" data-action="decrease">-</button>
                                         <span>${item.quantity}</span>
                                         <button class="quantity-btn" data-id="${item.id}" data-action="increase">+</button>
                                     </div>
                                </div>
                                <span>${price}</span>
                                <span class="cart-item-remove" data-id="${item.id}">&times;</span>
                            </div>
                        `;
                    }).join('');
                }
                
                const subtotal = cart.reduce((total, item) => total + (item.price * item.quantity), 0);
                let deliveryCharge = 0;
                
                const user = auth.currentUser;
                if(user && cart.length > 0) {
                    const ordersRef = collection(db, "orders");
                    const q = query(ordersRef, where("userId", "==", user.uid));
                    const querySnapshot = await getDocs(q);
                    
                    const userDocRef = doc(db, "users", user.uid);
                    const userDocSnap = await getDoc(userDocRef);

                    if (querySnapshot.empty) {
                        deliveryCharge = 0; // First order is free
                    } else if (userDocSnap.exists() && userDocSnap.data().address && userDocSnap.data().address.city) {
                        const city = userDocSnap.data().address.city.toLowerCase();
                        deliveryCharge = city.includes('tangail') ? 100 : 200;
                    } else {
                        // Default charge if city is not set
                        deliveryCharge = 200;
                    }
                    deliveryChargeRow.style.display = 'flex';
                } else {
                    deliveryChargeRow.style.display = 'none';
                }
                
                const grandTotal = subtotal + deliveryCharge;

                cartSubtotalPriceEl.textContent = formatPrice(subtotal, currentLang);
                cartDeliveryChargeEl.textContent = formatPrice(deliveryCharge, currentLang);
                cartTotalPriceEl.textContent = formatPrice(grandTotal, currentLang);
                cartCountEl.textContent = cart.reduce((total, item) => total + item.quantity, 0);
            }
            
            cartItemsList.addEventListener('click', (e) => {
                if (e.target.classList.contains('cart-item-remove')) {
                    const productId = e.target.dataset.id;
                    cart = cart.filter(item => item.id !== productId);
                    saveCart();
                } else if (e.target.classList.contains('quantity-btn')) {
                    updateCartQuantity(e.target.dataset.id, e.target.dataset.action);
                }
            });
            
            cartBtn.addEventListener('click', () => {
                cartModal.classList.add('visible');
                // If user is logged in, show order history tab by default if cart is empty
                if (auth.currentUser && cart.length === 0) {
                    document.querySelector('#cart-modal-overlay .auth-tab[data-tab="order-history"]').click();
                } else {
                     document.querySelector('#cart-modal-overlay .auth-tab[data-tab="shopping-cart"]').click();
                }
            });

            cartModalClose.addEventListener('click', () => closeModal('cart-modal-overlay'));
            cartModal.addEventListener('click', e => { if(e.target === cartModal) closeModal('cart-modal-overlay'); });

             // Tab switching for Cart Modal
            document.querySelectorAll('#cart-modal-overlay .auth-tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    document.querySelectorAll('#cart-modal-overlay .auth-tab').forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    document.getElementById('shopping-cart-view').style.display = tab.dataset.tab === 'shopping-cart' ? 'block' : 'none';
                    document.getElementById('order-history-cart-view').style.display = tab.dataset.tab === 'order-history' ? 'block' : 'none';
                    if (tab.dataset.tab === 'order-history' && !auth.currentUser) {
                         document.getElementById('orders-list-cart').innerHTML = `<p>Please login to see your orders.</p>`;
                    }
                });
            });


            // Checkout and Order History Logic
            const paymentModal = document.getElementById('payment-modal-overlay');
            const paymentModalClose = document.getElementById('payment-modal-close');
            const confirmOrderBtn = document.getElementById('confirm-order-btn');
            const successModal = document.getElementById('order-success-modal-overlay');
            const successModalClose = document.getElementById('order-success-modal-close');

            checkoutBtn.addEventListener('click', () => {
                if (auth.currentUser) {
                    closeModal('cart-modal-overlay');
                    // Activate COD by default
                    document.querySelectorAll('.payment-option').forEach(o => o.classList.remove('active'));
                    const codOption = document.querySelector('.payment-option[data-method="cod"]');
                    if (codOption) codOption.classList.add('active');
                    paymentModal.classList.add('visible');
                } else {
                    closeModal('cart-modal-overlay');
                    authModal.classList.add('visible');
                    showAuthMessage('Please login to checkout', true);
                }
            });
            
             paymentModalClose.addEventListener('click', () => closeModal('payment-modal-overlay'));
             paymentModal.addEventListener('click', e => { if(e.target === paymentModal) closeModal('payment-modal-overlay'); });
             successModalClose.addEventListener('click', () => closeModal('order-success-modal-overlay'));
             successModal.addEventListener('click', e => { if(e.target === successModal) closeModal('order-success-modal-overlay'); });
             
            document.querySelectorAll('.payment-option').forEach(opt => {
                opt.addEventListener('click', () => {
                    document.querySelectorAll('.payment-option').forEach(o => o.classList.remove('active'));
                    opt.classList.add('active');
                });
            });
            
            function generateInvoice(orderData) {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();

                doc.setFont('helvetica', 'bold');
                doc.setFontSize(20);
                doc.text("TangailBuzz", 14, 22);

                doc.setFontSize(10);
                doc.setFont('helvetica', 'normal');
                doc.text(`Invoice for Order: #${orderData.id.substring(0, 8)}`, 14, 30);
                doc.text(`Date: ${orderData.createdAt.toDate().toLocaleDateString()}`, 14, 35);
                
                doc.text(`Bill To:`, 14, 45);
                doc.text(orderData.userName, 14, 50);
                doc.text(orderData.shippingAddress.line1, 14, 55);
                doc.text(`${orderData.shippingAddress.city}, ${orderData.shippingAddress.postal}`, 14, 60);

                const tableColumn = ["Item", "Quantity", "Unit Price", "Total"];
                const tableRows = [];

                orderData.items.forEach(item => {
                    const itemData = [
                        item.name,
                        item.quantity,
                        formatPrice(item.price, 'en'),
                        formatPrice(item.price * item.quantity, 'en')
                    ];
                    tableRows.push(itemData);
                });

                doc.autoTable({
                    startY: 70,
                    head: [tableColumn],
                    body: tableRows,
                    theme: 'striped',
                    headStyles: { fillColor: [233, 75, 98] } // primary color
                });
                
                const finalY = doc.autoTable.previous.finalY;
                doc.setFontSize(10);
                doc.text(`Subtotal: ${formatPrice(orderData.subtotal, 'en')}`, 14, finalY + 10);
                doc.text(`Delivery Charge: ${formatPrice(orderData.deliveryCharge, 'en')}`, 14, finalY + 15);
                doc.setFont('helvetica', 'bold');
                doc.text(`Total: ${formatPrice(orderData.totalPrice, 'en')}`, 14, finalY + 20);
                doc.setFont('helvetica', 'normal');
                doc.text(`Payment Method: ${orderData.paymentMethod}`, 14, finalY + 25);

                doc.save(`TangailBuzz-Invoice-${orderData.id.substring(0,8)}.pdf`);
            }

            function listenToOrders(userId) {
                const ordersRef = collection(db, "orders");
                const q = query(ordersRef, where("userId", "==", userId));

                unsubscribeOrders = onSnapshot(q, (snapshot) => {
                    const orders = [];
                    snapshot.forEach(doc => {
                        orders.push({ id: doc.id, ...doc.data() });
                    });
                    
                    orders.sort((a, b) => {
                        const dateA = a.createdAt?.toDate() || 0;
                        const dateB = b.createdAt?.toDate() || 0;
                        return dateB - dateA; // Descending order
                    });

                    renderOrders(orders);
                });
            }

            function renderOrders(orders) {
                 const currentLang = localStorage.getItem('language') || 'bn';
                 const ordersListCart = document.getElementById('orders-list-cart');
                 const ordersListAccount = document.getElementById('orders-list');
                 
                if(orders.length === 0) {
                    const noOrdersText = `<p>${translations[currentLang]['no-orders']}</p>`;
                    ordersListCart.innerHTML = noOrdersText;
                    ordersListAccount.innerHTML = noOrdersText;
                    return;
                }

                const ordersHtml = orders.map(order => {
                    const statusClass = order.status ? `status-${order.status.toLowerCase()}` : 'status-pending';
                    const itemsHtml = order.items.map(item => `<div class="order-item">${item.quantity} x ${item.name}</div>`).join('');
                    
                    return `
                        <div class="order-card" data-order-id="${order.id}">
                            <div class="order-header">
                                <strong>Order #${order.id.substring(0, 8)}</strong>
                                <span class="order-status ${statusClass}">${order.status}</span>
                            </div>
                            <div class="order-body">
                                ${itemsHtml}
                            </div>
                            <div class="order-footer">
                                <span class="order-total">${formatPrice(order.totalPrice, currentLang)}</span>
                                ${order.status === 'Delivered' ? `<button class="invoice-btn" data-lang-key="invoice-btn">${translations[currentLang]['invoice-btn']}</button>` : ''}
                            </div>
                        </div>
                    `;
                }).join('');

                ordersListCart.innerHTML = ordersHtml;
                ordersListAccount.innerHTML = ordersHtml;

                document.querySelectorAll('.invoice-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const orderId = e.target.closest('.order-card').dataset.orderId;
                        const orderData = orders.find(o => o.id === orderId);
                        if(orderData) generateInvoice(orderData);
                    });
                });
            }


            confirmOrderBtn.addEventListener('click', async () => {
                const user = auth.currentUser;
                if (!user || cart.length === 0) return;

                confirmOrderBtn.disabled = true;
                const currentLang = localStorage.getItem('language') || 'bn';
                confirmOrderBtn.textContent = translations[currentLang]['processing-btn'] || 'Processing...';

                try {
                    const userDocRef = doc(db, "users", user.uid);
                    const docSnap = await getDoc(userDocRef);
                    
                    if (!docSnap.exists() || !docSnap.data().address || !docSnap.data().address.line1) {
                        showAuthMessage('Please save your address first!', true);
                        closeModal('payment-modal-overlay');
                        authModal.classList.add('visible');
                        showView('address-view');
                        return;
                    }
                    
                    const userData = docSnap.data();
                    const paymentMethodEl = document.querySelector('.payment-option.active');
                    if(!paymentMethodEl) {
                        showAuthMessage('Please select a payment method', true);
                        return;
                    }
                    const paymentMethod = paymentMethodEl.dataset.method;
                    const mobilePayment = document.querySelector('input[name="mobile-banking"]:checked')?.value;
                    
                    const ordersRef = collection(db, "orders");
                    const q = query(ordersRef, where("userId", "==", user.uid));
                    const querySnapshot = await getDocs(q);
                    let deliveryCharge = 0;
                    if (!querySnapshot.empty) {
                        const city = userData.address.city.toLowerCase();
                        deliveryCharge = city.includes('tangail') ? 100 : 200;
                    }

                    const subtotal = cart.reduce((total, item) => total + (item.price * item.quantity), 0);
                    
                    const orderData = {
                        userId: user.uid,
                        userName: userData.name || user.displayName || 'N/A',
                        userEmail: user.email,
                        userMobile: userData.mobile || '',
                        shippingAddress: userData.address,
                        items: cart.map(item => ({
                            productId: item.id,
                            name: item.nameEN || 'Product',
                            quantity: item.quantity,
                            price: item.price
                        })),
                        subtotal: subtotal,
                        deliveryCharge: deliveryCharge,
                        totalPrice: subtotal + deliveryCharge,
                        paymentMethod: paymentMethod === 'mobile' ? mobilePayment : paymentMethod.toUpperCase(),
                        status: 'Pending',
                        createdAt: serverTimestamp()
                    };

                    await addDoc(collection(db, "orders"), orderData);
                    closeModal('payment-modal-overlay');
                    successModal.classList.add('visible');
                    cart = [];
                    saveCart();

                    setTimeout(() => {
                        closeModal('order-success-modal-overlay');
                        cartModal.classList.add('visible');
                        document.querySelector('#cart-modal-overlay .auth-tab[data-tab="order-history"]').click();
                    }, 2500);

                } catch(e) {
                    console.error("Order confirmation failed:", e);
                    showAuthMessage(null, true, 'Order failed: ' + e.message);
                } finally {
                    confirmOrderBtn.disabled = false;
                    confirmOrderBtn.textContent = translations[currentLang]['confirm-order-btn'];
                }
            });

            // ----------- Product Data & Rendering Logic -----------

            const productGrid = document.querySelector('.product-grid');

            function renderStars(rating, maxRating = 5) {
                const filledStars = Math.round(rating);
                let starsHtml = '';
                for (let i = 0; i < maxRating; i++) {
                    if (i < filledStars) {
                        starsHtml += `<span style="color: var(--accent-yellow);">★</span>`;
                    } else {
                        starsHtml += `<span style="color: var(--text-light);">★</span>`;
                    }
                }
                return starsHtml;
            }

            function renderProducts(productsToRender) {
                const currentLang = localStorage.getItem('language') || 'bn';
                if(productsToRender.length === 0) {
                    productGrid.innerHTML = `<p>No products found.</p>`;
                    return;
                }

                productGrid.innerHTML = productsToRender.map(p => {
                    const data = getLocalizedProductData(p, currentLang);
                    
                    const price = formatPrice(data.price, currentLang);
                    let oldPrice = '';
                    if (p.isOffer && p.price) {
                        oldPrice = `<span class="old-price" data-price-old="${p.price}">${formatPrice(p.price, currentLang)}</span>`;
                    }
                    
                    const hasOffer = p.isOffer === true;
                    let offerTagHTML = '';
                    if (hasOffer) {
                        let offerText = translations[currentLang]['tag-offer'];
                        if (p.discount) {
                            const offText = translations[currentLang]['off-text'];
                            offerText = `${p.discount}% ${offText}`;
                        }
                        offerTagHTML = `<div class="offer-tag-right">${offerText}</div>`;
                    }
                    
                    return `
                        <div class="product-card" data-product-id="${p.id}">
                            ${offerTagHTML}
                            <img src="${data.mainImage}" alt="${data.name}">
                            <div class="product-info">
                                <h3>${data.name}</h3>
                                <div class="rating">${renderStars(data.rating)} (${data.rating.toFixed(1)})</div>
                                <div class="product-price">
                                    <span class="current-price" data-price="${data.price}">${price}</span>
                                    ${oldPrice}
                                </div>
                                <div class="product-actions">
                                    <a class="btn btn-details" data-lang-key="btn-details">${translations[currentLang]['btn-details']}</a>
                                    <a class="btn btn-add-cart" data-lang-key="btn-add-cart">${translations[currentLang]['btn-add-cart']}</a>
                                </div>
                            </div>
                        </div>`;
                }).join('');

                // Re-attach event listeners after rendering
                productGrid.querySelectorAll('.btn-details').forEach(button => {
                    button.addEventListener('click', function() {
                        const productId = this.closest('.product-card').dataset.productId;
                        openProductModal(productId);
                    });
                });
                productGrid.querySelectorAll('.product-card img').forEach(image => {
                    image.addEventListener('click', function() {
                        const productId = this.closest('.product-card').dataset.productId;
                        openProductModal(productId);
                    });
                });
                productGrid.querySelectorAll('.btn-add-cart').forEach(button => {
                    button.addEventListener('click', function() {
                        const productId = this.closest('.product-card').dataset.productId;
                        addToCart(productId);
                    });
                });
            }

            async function fetchProducts() {
                productGrid.innerHTML = '<p>Loading products...</p>';
                try {
                    const productsCol = collection(db, 'products');
                    const productSnapshot = await getDocs(productsCol);
                    allProducts = productSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    renderProducts(allProducts);
                } catch (error) {
                    console.error("Error fetching products: ", error);
                    productGrid.innerHTML = '<p>Error loading products. Please try again later.</p>';
                }
            }

            // --- Product Review Logic ---
            const reviewForm = document.getElementById('review-form');
            const reviewList = document.getElementById('reviews-list');
            const starsContainer = document.getElementById('star-rating');
            let currentRating = 0;

            if (starsContainer) {
                starsContainer.innerHTML = ''; // Clear existing stars
                for (let i = 1; i <= 5; i++) {
                    const star = document.createElement('span');
                    star.classList.add('star');
                    star.textContent = '★';
                    star.dataset.value = i;
                    star.addEventListener('click', () => {
                        currentRating = i;
                        updateStars();
                    });
                    starsContainer.appendChild(star);
                }
            }

            function updateStars() {
                if (starsContainer) {
                    starsContainer.querySelectorAll('.star').forEach(star => {
                        if (parseInt(star.dataset.value) <= currentRating) {
                            star.classList.add('filled');
                        } else {
                            star.classList.remove('filled');
                        }
                    });
                }
            }

            async function fetchReviews(productId) {
                if (!reviewList) return;
                reviewList.innerHTML = '<p>Loading reviews...</p>';
                const reviewsRef = collection(db, 'reviews');
                const q = query(reviewsRef, where('productId', '==', productId), orderBy('createdAt', 'desc'));
                const querySnapshot = await getDocs(q);

                if (querySnapshot.empty) {
                    reviewList.innerHTML = `<p>${translations[localStorage.getItem('language') || 'bn']['no-reviews']}</p>`;
                    return;
                }

                const reviews = querySnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                reviewList.innerHTML = reviews.map(r => {
                    const date = r.createdAt?.toDate ? r.createdAt.toDate().toLocaleDateString() : 'N/A';
                    const stars = renderStars(r.rating);
                    return `
                        <div class="review-card">
                            <div class="review-header">
                                <strong>${r.userName}</strong>
                                <span>${stars}</span>
                            </div>
                            <p>${r.comment}</p>
                            <small>${date}</small>
                        </div>
                    `;
                }).join('');
            }
            
            // ----------- Showcase Slider Logic -----------
            const showcaseSection = document.getElementById('showcase');
            const slider = document.querySelector('.slider');
            const sliderNav = document.querySelector('.slider-nav');
            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');
            let slideIndex = 0;
            let slideInterval;
            let slides = []; // Keep a reference to slide elements

            // Function to render the slider based on images
            function setupSlider(images) {
                if (images.length === 0) {
                    showcaseSection.style.display = 'none';
                    return;
                } else {
                    showcaseSection.style.display = 'block';
                }

                slider.innerHTML = ''; // Clear existing slides
                if (sliderNav) sliderNav.innerHTML = ''; // Clear existing dots

                images.forEach(imgData => {
                    const slide = document.createElement('div');
                    slide.className = 'slide';
                    const currentLang = localStorage.getItem('language') || 'bn';
                    const title = currentLang === 'bn' ? imgData.title?.bn || '' : imgData.title?.en || '';
                    const subtitle = currentLang === 'bn' ? imgData.subtitle?.bn || '' : imgData.subtitle?.en || '';
                    const buttonText = translations[currentLang]['cta-button'] || '';
                    
                    slide.innerHTML = `
                        <img src="${imgData.imgUrl}" alt="Slider Image">
                        <div class="slide-content">
                            <h1>${title}</h1>
                            <p>${subtitle}</p>
                            ${buttonText ? `<a class="cta-button">${buttonText}</a>` : ''}
                        </div>
                    `;
                    slider.appendChild(slide);
                });

                slides = document.querySelectorAll('.slide');
                if (slides.length <= 1) {
                    if (sliderNav) sliderNav.style.display = 'none';
                    if (prevBtn) prevBtn.style.display = 'none';
                    if (nextBtn) nextBtn.style.display = 'none';
                    return;
                }
                
                if (sliderNav) sliderNav.style.display = 'flex';
                if (prevBtn) prevBtn.style.display = 'flex';
                if (nextBtn) nextBtn.style.display = 'flex';

                createDots();
                goToSlide(0);
                resetInterval();
            }

            function createDots() {
                if (!sliderNav) return;
                slides.forEach((_, i) => {
                    const dot = document.createElement('div');
                    dot.classList.add('slider-dot');
                    if (i === 0) dot.classList.add('active');
                    dot.addEventListener('click', () => {
                        goToSlide(i);
                        resetInterval();
                    });
                    sliderNav.appendChild(dot);
                });
            }

            function updateDots() {
                if (slides.length === 0 || !sliderNav) return;
                const dots = document.querySelectorAll('.slider-dot');
                dots.forEach(dot => dot.classList.remove('active'));
                dots[slideIndex].classList.add('active');
            }

            function goToSlide(index) {
                if (slides.length === 0 || !slider) return;
                if (index < 0) {
                    slideIndex = slides.length - 1;
                } else if (index >= slides.length) {
                    slideIndex = 0;
                } else {
                    slideIndex = index;
                }
                slider.style.transform = `translateX(-${slideIndex * 100}%)`;
                updateDots();
            }
            
            function nextSlide() { goToSlide(slideIndex + 1); }
            function prevSlide() { goToSlide(slideIndex - 1); }
            
            function resetInterval() {
                clearInterval(slideInterval);
                slideInterval = setInterval(nextSlide, 5000); // 5 seconds
            }
            
            if (prevBtn) prevBtn.addEventListener('click', () => { prevSlide(); resetInterval(); });
            if (nextBtn) nextBtn.addEventListener('click', () => { nextSlide(); resetInterval(); });

            async function fetchAndRenderSlider() {
                try {
                    const sliderCol = collection(db, 'banners');
                    const q = query(sliderCol, orderBy("createdAt", "desc"));
                    const sliderSnapshot = await getDocs(q);
                    let sliderImages = sliderSnapshot.docs.map(doc => doc.data());
                    
                    if (sliderImages.length === 0) {
                        // Use default images if the database collection is empty
                        console.log("No banners found in Firestore. Using default images.");
                        const defaultImages = [
                             { imgUrl: 'https://images.unsplash.com/photo-1523275335684-37898b6baf30?q=80&w=1999&auto=format&fit=crop', title: {bn: 'TangailBuzz এ আপনাকে স্বাগতম', en: 'Welcome to TangailBuzz'}, subtitle: {bn: 'বাংলাদেশের সেরা ই-কমার্স প্ল্যাটফর্ম। আপনার প্রয়োজনীয় সবকিছু এক জায়গায়।', en: 'The best e-commerce platform in Bangladesh. Everything you need in one place.'}, buttonText: 'শপিং শুরু করুন' },
                            { imgUrl: 'https://images.unsplash.com/photo-1542291026-7eec264c27ab?q=80&w=2070&auto=format&fit=crop', title: {bn: 'সেরা ফ্যাশন কালেকশন', en: 'Best Fashion Collection'}, subtitle: {bn: 'আধুনা থেকে ঐতিহ্যবাহী, সবই পাবেন এখানে।', en: 'From modern to traditional, find it all here.'}, buttonText: 'শপিং শুরু করুন' },
                            { imgUrl: 'https://images.unsplash.com/photo-1505740420928-5e560c06d30e?q=80&w=2070&auto=format&fit=crop', title: {bn: 'লেটেস্ট ইলেকট্রনিক্স', en: 'Latest Electronics'}, subtitle: {bn: 'আপনার জীবনকে করুন আরও সহজ ও আধুনিক।', en: 'Make your life easier and more modern.'}, buttonText: 'শপিং শুরু করুন' }
                        ];
                        sliderImages = defaultImages;
                    }
                    setupSlider(sliderImages);

                } catch (error) {
                    console.error("Error fetching slider images from Firestore. Using default fallback images.", error);
                    // This block also uses a default fallback to prevent the app from breaking.
                    const defaultImages = [
                        { imgUrl: 'https://images.unsplash.com/photo-1523275335684-37898b6baf30?q=80&w=1999&auto=format&fit=crop', title: {bn: 'TangailBuzz এ আপনাকে স্বাগতম', en: 'Welcome to TangailBuzz'}, subtitle: {bn: 'বাংলাদেশের সেরা ই-কমার্স প্ল্যাটফর্ম। আপনার প্রয়োজনীয় সবকিছু এক জায়গায়।', en: 'The best e-commerce platform in Bangladesh. Everything you need in one place.'}, buttonText: 'শপিং শুরু করুন' },
                        { imgUrl: 'https://images.unsplash.com/photo-1542291026-7eec264c27ab?q=80&w=2070&auto=format&fit=crop', title: {bn: 'সেরা ফ্যাশন কালেকশন', en: 'Best Fashion Collection'}, subtitle: {bn: 'আধুনা থেকে ঐতিহ্যবাহী, সবই পাবেন এখানে।', en: 'From modern to traditional, find it all here.'}, buttonText: 'শপিং শুরু করুন' },
                        { imgUrl: 'https://images.unsplash.com/photo-1505740420928-5e560c06d30e?q=80&w=2070&auto=format&fit=crop', title: {bn: 'লেটেস্ট ইলেকট্রনিক্স', en: 'Latest Electronics'}, subtitle: {bn: 'আপনার জীবনকে করুন আরও সহজ ও আধুনিক।', en: 'Make your life easier and more modern.'}, buttonText: 'শপিং শুরু করুন' }
                    ];
                    setupSlider(defaultImages);
                }
            }


            // Initial Load
            const savedLang = localStorage.getItem('language') || 'bn';
            setLanguage(savedLang);
            updateCartUI();
            fetchProducts();
            fetchAndRenderSlider();
        });
    </script>

</body>
</html>
